var ue=Object.defineProperty;var Nt=r=>{throw TypeError(r)};var de=(r,e,t)=>e in r?ue(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var l=(r,e,t)=>de(r,typeof e!="symbol"?e+"":e,t),jt=(r,e,t)=>e.has(r)||Nt("Cannot "+t);var I=(r,e,t)=>(jt(r,e,"read from private field"),t?t.call(r):e.get(r)),U=(r,e,t)=>e.has(r)?Nt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),B=(r,e,t,s)=>(jt(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class H{constructor(){l(this,"eventMap",new Map)}fire(e,...t){var s;return(s=this.eventMap.get(e))==null||s.forEach(i=>i(...t)),this}on(e,t){const s=this.eventMap.get(e)??this.eventMap.set(e,new Set).get(e);return s==null||s.add(t),this}off(e,t){var s;return(s=this.eventMap.get(e))==null||s.delete(t),this}once(e,t){const s=(...n)=>{var o;(o=this.eventMap.get(e))==null||o.delete(s),t(...n)},i=this.eventMap.get(e)??this.eventMap.set(e,new Set).get(e);return i==null||i.add(s),this}}class Xt{constructor(){l(this,"domEvents",{});l(this,"events",new H)}on(e,t,s){e=$.orArrayResolve(e);for(const i of e){this.domEvents[i]||(this.domEvents[i]=new Map);const n=o=>{t(o,this)};this.domEvents[i].set(t,n),this.events.on(i,t),this.dom.addEventListener(i,n,s)}return this}off(e,t,s){var n;const i=(n=this.domEvents[e])==null?void 0:n.get(t);return i&&this.dom.removeEventListener(e,i,s),this.events.off(e,t),this}once(e,t,s){const i=n=>{this.dom.removeEventListener(e,i,s),t(n,this)};return this.dom.addEventListener(e,i,s),this.events.once(e,t),this}trigger(e){this.dom.dispatchEvent(new Event(e))}}class E extends H{constructor(t,s){super();l(this,"_value");l(this,"_convert");l(this,"attributes",new Map);l(this,"linkStates",new Set);l(this,"options",{});this.set(t),s&&(this.options=s)}static create(t,s){return new E(t,s)}set(t,s){if(this._value=t,t instanceof E)t.linkStates.add(this);else if(t instanceof Object){const i=new Map(Object.entries(this));for(const[n,o]of Object.entries(t)){const a=i.get(`${n}$`);a instanceof E?a.set(o):Object.assign(this,{[`${n}$`]:$.state(o).on("change",({state$:c})=>{Object.assign(this._value,{[n]:c._value})})})}}this.fire("change",{state$:this}),s!=null&&s.disableUpdate||this.update(),s!=null&&s.disableUpdateLink||this.linkStates.forEach(i=>i.update())}static toJSON(t){const s={};for(let[i,n]of Object.entries(t))n instanceof E?n=n.toJSON():n instanceof Object&&E.toJSON(n),Object.assign(s,{[i]:n});return s}update(){for(const[t,s]of this.attributes.entries())for(const i of s)t[i]instanceof Function?this.options.format?t[i](this.options.format(this.value)):t[i](this.value):i in t&&(t[i]=this.value);this.fire("update",{state$:this})}use(t,s){const i=this.attributes.get(t);i?i.add(s):this.attributes.set(t,new Set().add(s))}convert(t){const s=new E(this);return s._convert=t,s}get value(){return this._value instanceof E?this._convert?this._convert(this._value.value):this._value.value:this._value}toString(){return this.options.format?`${this.options.format(this.value)}`:this.value instanceof Object?JSON.stringify(this.toJSON()):`${this.value}`}toJSON(){return this.value instanceof E?this.value.toJSON():this.value instanceof Object?E.toJSON(this.value):this.toString()}isType(){return this._value===null||this._value===void 0?null:this}}class ot extends Xt{constructor(){super(...arguments);l(this,"__$property__",{hidden:!1,coordinate:void 0});l(this,"parent")}hide(t,s=!0){return $.fluent(this,arguments,()=>this.__$property__.hidden,()=>{var i;if(t!==void 0)return t instanceof E?(this.__$property__.hidden=t.value,t.use(this,"hide")):this.__$property__.hidden=t,s&&((i=this.parent)==null||i.children.render()),this})}remove(){var t;return(t=this.parent)==null||t.children.remove(this).render(),this}replace(t){var s;return(s=this.parent)==null||s.children.replace(this,t).render(),this}contains(t){return t?t instanceof ot?this.dom.contains(t.dom):t instanceof EventTarget?this.dom.contains($(t).dom):this.dom.contains(t):!1}coordinate(t){return $.fluent(this,arguments,()=>this.__$property__.coordinate,()=>$.set(this.__$property__,"coordinate",t))}self(t){return $.orArrayResolve(t).forEach(s=>s(this)),this}inDOM(){return document.contains(this.dom)}get element(){return this.dom instanceof Element?this:null}get htmlElement(){return this.dom instanceof HTMLElement?this:null}}var _;(r=>{function e(i){return i instanceof Array?i:[i]}r.orArrayResolve=e;function t(i,n){return e(n).forEach(o=>{Object.getOwnPropertyNames(o.prototype).forEach(a=>{a!=="constructor"&&Object.defineProperty(i.prototype,a,Object.getOwnPropertyDescriptor(o.prototype,a)||Object.create(null))})}),i}r.mixin=t;function s(i){return i.map(n=>n==null?void 0:n.split(" ").filter(o=>o.length)).flat().detype(void 0)}r.classlist=s})(_||(_={}));class W extends ot{constructor(t,s){super();l(this,"dom");l(this,"static_classes",new Set);this.dom=this.createDom(t,s),this.dom.$=this,this.setOptions(s)}createDom(t,s){return s!=null&&s.dom?s.dom:t==="svg"?document.createElementNS("http://www.w3.org/2000/svg","svg"):document.createElement((s==null?void 0:s.tagname)??t)}setOptions(t){return this.id(t==null?void 0:t.id),t&&t.class&&this.class(...t.class),this}id(t){return $.fluent(this,arguments,()=>this.dom.id,()=>$.set(this.dom,"id",t))}class(...t){return $.fluent(this,arguments,()=>this.dom.classList,()=>{this.dom.classList.forEach(s=>this.static_classes.has(s)??this.dom.classList.remove(s)),this.dom.classList.add(..._.classlist(t))})}addClass(...t){return $.fluent(this,arguments,()=>this,()=>{this.dom.classList.add(..._.classlist(t))})}removeClass(...t){return $.fluent(this,arguments,()=>this,()=>{this.dom.classList.remove(..._.classlist(t))})}staticClass(...t){return $.fluent(this,arguments,()=>this.static_classes,()=>{t=_.classlist(t),this.removeClass(...this.static_classes),this.static_classes.clear(),this.addStaticClass(...t)})}addStaticClass(...t){return $.fluent(this,arguments,()=>this,()=>{t=_.classlist(t),t.detype().forEach(s=>this.static_classes.add(s)),this.addClass(...t)})}removeStaticClass(...t){return $.fluent(this,arguments,()=>this,()=>{t=_.classlist(t),t.detype().forEach(s=>this.static_classes.delete(s)),this.removeClass(...t)})}style(t){return $.fluent(this,arguments,()=>this.dom.style,()=>{Object.assign(this.dom.style,t)})}attribute(t,s){return arguments.length?arguments.length===1?t===void 0?null:this.dom.getAttribute(t):arguments.length===2?t?(s===null?this.dom.removeAttribute(t):s!==void 0&&this.dom.setAttribute(t,`${s}`),this):this:this:null}tabIndex(t){return $.fluent(this,arguments,()=>this.dom.tabIndex,()=>$.set(this.dom,"tabIndex",t))}focus(t){return this.dom.focus(t),this}blur(){return this.dom.blur(),this}animate(t,s,i){const n=this.dom.animate(t,s);return i&&(n.onfinish=()=>i(n)),n}getAnimations(t){return this.dom.getAnimations(t)}get dataset(){return this.dom.dataset}domRect(t){const s=this.dom.getBoundingClientRect();if(!t)return s;const i=t instanceof W?t.dom.getBoundingClientRect():t;return{...s,top:s.top-i.top,left:s.left-i.left,right:s.right-i.left,bottom:s.bottom-i.top,x:s.x-i.x,y:s.y-i.y}}}class ut extends ot{constructor(t){super();l(this,"dom");this.dom=t,this.dom.$=this}domRect(t){const s={bottom:innerHeight,height:innerHeight,left:0,right:innerWidth,top:0,width:innerWidth,x:0,y:0};if(!t)return s;const i=t instanceof W?t.dom.getBoundingClientRect():t;return{...s,top:s.top-i.top,left:s.left-i.left,right:s.right-i.left,bottom:s.bottom-i.top,x:s.x-i.x,y:s.y-i.y}}static from(t){return t.$ instanceof ut?t.$:new ut(t)}}const fe="modulepreload",pe=function(r){return"/"+r},Ft={},me=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=pe(c),c in Ft)return;Ft[c]=!0;const h=c.endsWith(".css"),f=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const u=document.createElement("link");if(u.rel=h?"stylesheet":fe,h||(u.as="script"),u.crossOrigin="",u.href=c,a&&u.setAttribute("nonce",a),document.head.appendChild(u),h)return new Promise((d,m)=>{u.addEventListener("load",d),u.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return e().catch(n)})};class ge{constructor(e){l(this,"$container");l(this,"childList",new Set);this.$container=e}add(e,t=-1){if(t===-1||this.childList.size-1===t)this.childList.add(e);else{const s=[...this.childList];s.splice(t,0,e),this.childList.clear(),s.forEach(i=>this.childList.add(i))}e.parent=this.$container}remove(e){return this.childList.has(e)?(this.childList.delete(e),e.parent=void 0,this):this}removeAll(e=!0){this.childList.forEach(t=>this.remove(t)),e&&this.render()}replace(e,t){const s=this.array;return s.splice(s.indexOf(e),1,t),e.remove(),this.childList.clear(),s.forEach(i=>this.childList.add(i)),t.parent=this.$container,this}render(){const[e,t]=[this.array.map(i=>i.dom),Array.from(this.dom.childNodes)],s=[];for(;t.length||e.length;){const[i,n]=[t.at(0),e.at(0)];n?i?n!==i?(n.$.hide()||(this.dom.insertBefore(n,i),s.push(n)),e.shift()):(n.$.hide()&&this.dom.removeChild(n),e.shift(),t.shift()):(n.$.hide()||this.dom.append(n),e.shift()):(i&&!s.includes(i)&&i.remove(),t.shift())}}indexOf(e){return this.array.indexOf(e)}get array(){return[...this.childList.values()]}get dom(){return this.$container.dom}}class Z extends ot{constructor(t){super();l(this,"dom");this.dom=new Text(t),this.dom.$=this}content(t){return $.fluent(this,arguments,()=>this.dom.textContent,()=>$.set(this.dom,"textContent",t))}}class rt extends W{constructor(e,t){super(e,t)}autocapitalize(e){return $.fluent(this,arguments,()=>this.dom.autocapitalize,()=>$.set(this.dom,"autocapitalize",e))}innerText(e){return $.fluent(this,arguments,()=>this.dom.innerText,()=>$.set(this.dom,"innerText",e))}title(e){return $.fluent(this,arguments,()=>this.dom.title,()=>$.set(this.dom,"title",e))}dir(e){return $.fluent(this,arguments,()=>this.dom.dir,()=>$.set(this.dom,"dir",e))}translate(e){return $.fluent(this,arguments,()=>this.dom.translate,()=>$.set(this.dom,"translate",e))}popover(e){return $.fluent(this,arguments,()=>this.dom.popover,()=>$.set(this.dom,"popover",e))}spellcheck(e){return $.fluent(this,arguments,()=>this.dom.spellcheck,()=>$.set(this.dom,"spellcheck",e))}inert(e){return $.fluent(this,arguments,()=>this.dom.inert,()=>$.set(this.dom,"inert",e))}lang(e){return $.fluent(this,arguments,()=>this.dom.lang,()=>$.set(this.dom,"lang",e))}draggable(e){return $.fluent(this,arguments,()=>this.dom.draggable,()=>$.set(this.dom,"draggable",e))}hidden(e){return $.fluent(this,arguments,()=>this.dom.hidden,()=>$.set(this.dom,"hidden",e))}click(){return this.dom.click(),this}attachInternals(){return this.dom.attachInternals()}hidePopover(){return this.dom.hidePopover(),this}showPopover(){return this.dom.showPopover(),this}togglePopover(){return this.dom.togglePopover(),this}get accessKeyLabel(){return this.dom.accessKeyLabel}get offsetHeight(){return this.dom.offsetHeight}get offsetLeft(){return this.dom.offsetLeft}get offsetParent(){return $(this.dom.offsetParent)}get offsetTop(){return this.dom.offsetTop}get offsetWidth(){return this.dom.offsetWidth}}class p extends rt{constructor(t,s){super(t,s);l(this,"children",new ge(this));l(this,"__position_cursor",0)}content(t){return $.fluent(this,arguments,()=>this,()=>{this.children.removeAll(!1),this.insert(t)})}insert(t,s=-1){return $.fluent(this,arguments,()=>this,async()=>{if(t instanceof Function){let i=t(this);i instanceof Promise?t=await i:t=i}else t instanceof Promise&&(t=await t);t=$.orArrayResolve(t),this.__position_cursor=s<0?this.children.array.length+s:s;for(const i of t)if(i!=null){if(i instanceof Array)this.insert(i,this.__position_cursor);else if(typeof i=="string")this.children.add(new Z(i),s);else if(i instanceof E){const n=new Z(i.toString());i.use(n,"content"),this.children.add(n,s)}else if(i instanceof Promise){const n=(await me(async()=>{const{$Async:a}=await Promise.resolve().then(()=>xe);return{$Async:a}},void 0)).$Async,o=new n().await(i);this.children.add(o,s)}else this.children.add(i,s);this.__position_cursor+=1}this.children.render()})}clear(){return this.children.removeAll(),this}$(t){if(t.startsWith("::"))return Array.from(this.dom.querySelectorAll(t.replace(/^::/,""))).map(s=>$(s));if(t.startsWith(":"))return $(this.dom.querySelector(t.replace(/^:/,"")))}get scrollHeight(){return this.dom.scrollHeight}get scrollWidth(){return this.dom.scrollWidth}scrollTop(t){return $.fluent(this,arguments,()=>this.dom.scrollTop,()=>$.set(this.dom,"scrollTop",t))}scrollLeft(t){return $.fluent(this,arguments,()=>this.dom.scrollLeft,()=>$.set(this.dom,"scrollLeft",t))}}class Gt extends p{constructor(e){super("a",e),this.dom.addEventListener("click",t=>{$.anchorHandler&&this.href()&&(t.preventDefault(),$.anchorHandler(this,t))})}href(e){return $.fluent(this,arguments,()=>this.dom.href,()=>$.set(this.dom,"href",e))}target(e){return $.fluent(this,arguments,()=>this.dom.target??void 0,()=>{e&&(this.dom.target=e)})}}class D{static create(...e){const t=class{};return Object.getOwnPropertyNames(D.prototype).forEach(s=>{s!=="constructor"&&e.includes(s)&&Object.defineProperty(t.prototype,s,Object.getOwnPropertyDescriptor(D.prototype,s)||Object.create(null))}),t}disabled(e){return $.fluent(this,arguments,()=>this.dom.disabled,()=>$.set(this.dom,"disabled",e))}checkValidity(){return this.dom.checkValidity()}reportValidity(){return this.dom.reportValidity()}formAction(e){return $.fluent(this,arguments,()=>this.dom.formAction,()=>$.set(this.dom,"formAction",e))}formEnctype(e){return $.fluent(this,arguments,()=>this.dom.formEnctype,()=>$.set(this.dom,"formEnctype",e))}formMethod(e){return $.fluent(this,arguments,()=>this.dom.formMethod,()=>$.set(this.dom,"formMethod",e))}formNoValidate(e){return $.fluent(this,arguments,()=>this.dom.formNoValidate,()=>$.set(this.dom,"formNoValidate",e))}formTarget(e){return $.fluent(this,arguments,()=>this.dom.formTarget,()=>$.set(this.dom,"formTarget",e))}autocomplete(e){return $.fluent(this,arguments,()=>this.dom.autocomplete,()=>$.set(this.dom,"autocomplete",e))}name(e){return $.fluent(this,arguments,()=>this.dom.name,()=>$.set(this.dom,"name",e))}maxLength(e){return $.fluent(this,arguments,()=>this.dom.maxLength,()=>$.set(this.dom,"maxLength",e))}minLength(e){return $.fluent(this,arguments,()=>this.dom.minLength,()=>$.set(this.dom,"minLength",e))}required(e){return $.fluent(this,arguments,()=>this.dom.required,()=>$.set(this.dom,"required",e))}label(e){return $.fluent(this,arguments,()=>this.dom.label,()=>$.set(this.dom,"label",e))}get form(){return this.dom.form?$(this.dom.form):null}get validationMessage(){return this.dom.validationMessage}get validity(){return this.dom.validity}get willValidate(){return this.dom.willValidate}}class Dt extends p{constructor(e){super("button",e)}type(e){return $.fluent(this,arguments,()=>this.dom.type,()=>$.set(this.dom,"type",e))}}_.mixin(Dt,D.create("disabled","checkValidity","formAction","formEnctype","formMethod","formNoValidate","formTarget","reportValidity"));class Kt extends p{constructor(e){super("form",e)}action(e){return $.fluent(this,arguments,()=>this.dom.formAction,()=>$.set(this.dom,"formAction",e))}enctype(e){return $.fluent(this,arguments,()=>this.dom.formEnctype,()=>$.set(this.dom,"formEnctype",e))}method(e){return $.fluent(this,arguments,()=>this.dom.formMethod,()=>$.set(this.dom,"formMethod",e))}noValidate(e){return $.fluent(this,arguments,()=>this.dom.formNoValidate,()=>$.set(this.dom,"formNoValidate",e))}acceptCharset(e){return $.fluent(this,arguments,()=>this.dom.acceptCharset,()=>$.set(this.dom,"acceptCharset",e))}target(e){return $.fluent(this,arguments,()=>this.dom.formTarget,()=>$.set(this.dom,"formTarget",e))}requestSubmit(){return this.dom.requestSubmit(),this}reset(){return this.dom.reset(),this}submit(){return this.dom.submit(),this}get length(){return this.dom.length}get elements(){return Array.from(this.dom.elements).map(e=>$(e))}}_.mixin(Kt,D.create("checkValidity","reportValidity","autocomplete"));class M extends rt{constructor(e){super("input",e)}value(e){return $.fluent(this,arguments,()=>this.type()==="number"?Number(this.dom.value):this.dom.value,()=>$.set(this.dom,"value",e,t=>{this.on("input",()=>{t.attributes.has(this.dom)!==!1&&(typeof t.value=="string"&&t.set(`${this.value()}`,{disableUpdate:!0}),typeof t.value=="number"&&t.set(Number(this.value()),{disableUpdate:!0}))})}))}type(e){return $.fluent(this,arguments,()=>this.dom.type,()=>$.set(this.dom,"type",e))}capture(e){return $.fluent(this,arguments,()=>this.dom.capture,()=>$.set(this.dom,"capture",e))}alt(e){return $.fluent(this,arguments,()=>this.dom.alt,()=>$.set(this.dom,"alt",e))}height(e){return $.fluent(this,arguments,()=>this.dom.height,()=>$.set(this.dom,"height",e))}width(e){return $.fluent(this,arguments,()=>this.dom.width,()=>$.set(this.dom,"width",e))}defaultValue(e){return $.fluent(this,arguments,()=>this.dom.defaultValue,()=>$.set(this.dom,"defaultValue",e))}dirName(e){return $.fluent(this,arguments,()=>this.dom.dirName,()=>$.set(this.dom,"dirName",e))}pattern(e){return $.fluent(this,arguments,()=>this.dom.pattern,()=>$.set(this.dom,"pattern",e))}placeholder(e){return $.fluent(this,arguments,()=>this.dom.placeholder,()=>$.set(this.dom,"placeholder",e))}readOnly(e){return $.fluent(this,arguments,()=>this.dom.readOnly,()=>$.set(this.dom,"readOnly",e))}selectionDirection(e){return $.fluent(this,arguments,()=>this.dom.selectionDirection,()=>$.set(this.dom,"selectionDirection",e))}selectionEnd(e){return $.fluent(this,arguments,()=>this.dom.selectionEnd,()=>$.set(this.dom,"selectionEnd",e))}selectionStart(e){return $.fluent(this,arguments,()=>this.dom.selectionStart,()=>$.set(this.dom,"selectionStart",e))}size(e){return $.fluent(this,arguments,()=>this.dom.size,()=>$.set(this.dom,"size",e))}src(e){return $.fluent(this,arguments,()=>this.dom.src,()=>$.set(this.dom,"src",e))}inputMode(e){return $.fluent(this,arguments,()=>this.dom.inputMode,()=>$.set(this.dom,"inputMode",e))}valueAsDate(e){return $.fluent(this,arguments,()=>this.dom.valueAsDate,()=>$.set(this.dom,"valueAsDate",e))}valueAsNumber(e){return $.fluent(this,arguments,()=>this.dom.valueAsNumber,()=>$.set(this.dom,"valueAsNumber",e))}webkitdirectory(e){return $.fluent(this,arguments,()=>this.dom.webkitdirectory,()=>$.set(this.dom,"webkitdirectory",e))}select(){return this.dom.select(),this}setCustomValidity(e){return this.dom.setCustomValidity(e),this}setRangeText(e,t,s,i){return typeof t=="number"&&typeof s=="number"&&this.dom.setRangeText(e,t,s,i),this.dom.setRangeText(e),this}setSelectionRange(e,t,s){return this.dom.setSelectionRange(e,t,s),this}showPicker(){return this.dom.showPicker(),this}get files(){return this.dom.files}get webkitEntries(){return this.dom.webkitEntries}get labels(){return Array.from(this.dom.labels??[]).map(e=>$(e))}}_.mixin(M,D.create("checkValidity","reportValidity","autocomplete","name","form","required","validationMessage","validity","willValidate","formAction","formEnctype","formMethod","formNoValidate","formTarget"));class $e extends M{constructor(e){super(e),this.type("number")}static from(e){return $.mixin(M,this)}stepDown(){return this.dom.stepDown(),this}stepUp(){return this.dom.stepUp(),this}max(e){return $.fluent(this,arguments,()=>this.dom.max===""?null:parseInt(this.dom.min),()=>$.set(this.dom,"max",e==null?void 0:e.toString()))}min(e){return $.fluent(this,arguments,()=>this.dom.min===""?null:parseInt(this.dom.min),()=>$.set(this.dom,"min",e==null?void 0:e.toString()))}step(e){return $.fluent(this,arguments,()=>Number(this.dom.step),()=>$.set(this.dom,"step",e==null?void 0:e.toString()))}}class ye extends M{constructor(e){super(e),this.type("radio")}static from(e){return $.mixin(M,this)}checked(e){return $.fluent(this,arguments,()=>this.dom.checked,()=>$.set(this.dom,"checked",e))}defaultChecked(e){return $.fluent(this,arguments,()=>this.dom.defaultChecked,()=>$.set(this.dom,"defaultChecked",e))}}class ve extends M{constructor(e){super(e),this.type("file")}static from(e){return $.mixin(M,this)}multiple(e){return $.fluent(this,arguments,()=>this.dom.multiple,()=>$.set(this.dom,"multiple",e))}accept(...e){return $.fluent(this,arguments,()=>this.dom.accept.split(","),()=>this.dom.accept=e.toString())}}_.mixin(M,[$e,ye,ve]);class Yt extends p{constructor(e){super("label",e)}for(e){return $.fluent(this,arguments,()=>this.dom.htmlFor,()=>{$.set(this.dom,"htmlFor",e)})}get control(){return this.dom.control}}_.mixin(Yt,D.create("form"));class be extends rt{constructor(e){super("img",e)}async load(e){return new Promise(t=>{const s=this.once("load",()=>{t(s)});typeof e=="string"?s.src(e):e.then(i=>s.src(i))})}static resize(e,t){return new Promise(s=>{const i=new Image;if(i.addEventListener("load",()=>{const n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw"$Image.resize: context undefined";const a=i.width/i.height,[c,h,f]=[a>1,a<1,a===1],u=t instanceof Array?t[0]:h?t:t*a,d=t instanceof Array?t[1]:c?t:t/a;n.height=d,n.width=u,o.drawImage(i,0,0,u,d),s(n.toDataURL())},{once:!0}),e instanceof File){const n=new FileReader;n.addEventListener("load",()=>i.src=n.result),n.readAsDataURL(e)}else i.src=e})}alt(e){return $.fluent(this,arguments,()=>this.dom.alt,()=>$.set(this.dom,"alt",e))}crossOrigin(e){return $.fluent(this,arguments,()=>this.dom.crossOrigin,()=>$.set(this.dom,"crossOrigin",e))}decoding(e){return $.fluent(this,arguments,()=>this.dom.decoding,()=>$.set(this.dom,"decoding",e))}height(e){return $.fluent(this,arguments,()=>this.dom.height,()=>$.set(this.dom,"height",e))}isMap(e){return $.fluent(this,arguments,()=>this.dom.isMap,()=>$.set(this.dom,"isMap",e))}loading(e){return $.fluent(this,arguments,()=>this.dom.loading,()=>$.set(this.dom,"loading",e))}referrerPolicy(e){return $.fluent(this,arguments,()=>this.dom.referrerPolicy,()=>$.set(this.dom,"referrerPolicy",e))}sizes(e){return $.fluent(this,arguments,()=>this.dom.sizes,()=>$.set(this.dom,"sizes",e))}src(e){return $.fluent(this,arguments,()=>this.dom.src,()=>$.set(this.dom,"src",e))}srcset(e){return $.fluent(this,arguments,()=>this.dom.srcset,()=>$.set(this.dom,"srcset",e))}useMap(e){return $.fluent(this,arguments,()=>this.dom.useMap,()=>$.set(this.dom,"useMap",e))}width(e){return $.fluent(this,arguments,()=>this.dom.width,()=>$.set(this.dom,"width",e))}decode(){return this.dom.decode()}get complete(){return this.dom.complete}get currentSrc(){return this.dom.currentSrc}get naturalHeight(){return this.dom.naturalHeight}get naturalWidth(){return this.dom.naturalWidth}get x(){return this.dom.x}get y(){return this.dom.y}}class we extends p{constructor(e){super("canvas",e)}height(e){return $.fluent(this,arguments,()=>this.dom.height,()=>{$.set(this.dom,"height",e)})}width(e){return $.fluent(this,arguments,()=>this.dom.width,()=>{$.set(this.dom,"width",e)})}captureStream(e){return this.dom.captureStream(e)}getContext(e,t){return this.dom.getContext(e)}toBlob(e,t,s){return this.dom.toBlob(e,t,s),this}toDataURL(e,t){return this.dom.toDataURL(e,t)}transferControlToOffscreen(){return this.dom.transferControlToOffscreen()}}class _e extends p{constructor(e){super("dialog",e)}open(e){return $.fluent(this,arguments,()=>this.dom.open,()=>$.set(this.dom,"open",e))}returnValue(e){return $.fluent(this,arguments,()=>this.dom.returnValue,()=>$.set(this.dom,"returnValue",e))}close(){return this.dom.close(),this}show(){return this.dom.show(),this}showModal(){return this.dom.showModal(),this}}class qt extends p{constructor(e){super("select")}add(e){return this.insert(e),this}item(e){return $(this.dom.item(e))}namedItem(e){return $(this.dom.namedItem(e))}multiple(e){return $.fluent(this,arguments,()=>this.dom.multiple,()=>$.set(this.dom,"multiple",e))}get length(){return this.dom.length}get size(){return this.dom.size}get options(){return Array.from(this.dom.options).map(e=>$(e))}get selectedIndex(){return this.dom.selectedIndex}get selectedOptions(){return Array.from(this.dom.selectedOptions).map(e=>$(e))}value(e){return $.fluent(this,arguments,()=>this.dom.value,()=>$.set(this.dom,"value",e,t=>{this.on("input",()=>{t.attributes.has(this.dom)!==!1&&(typeof t.value=="string"&&t.set(`${this.value()}`),typeof t.value=="number"&&t.set(Number(this.value())))})}))}get labels(){return Array.from(this.dom.labels??[]).map(e=>$(e))}}_.mixin(qt,D.create("checkValidity","reportValidity","autocomplete","name","form","required","disabled","validationMessage","validity","willValidate"));class Jt extends p{constructor(e){super("option",e)}defaultSelected(e){return $.fluent(this,arguments,()=>this.dom.defaultSelected,()=>$.set(this.dom,"defaultSelected",e))}selected(e){return $.fluent(this,arguments,()=>this.dom.selected,()=>$.set(this.dom,"selected",e))}text(e){return $.fluent(this,arguments,()=>this.dom.text,()=>$.set(this.dom,"text",e))}value(e){return $.fluent(this,arguments,()=>this.dom.value,()=>$.set(this.dom,"value",e))}get form(){return this.dom.form?$(this.dom.form):null}get index(){return this.dom.index}}_.mixin(Jt,D.create("form","disabled","label"));class Qt extends p{constructor(e){super("optgroup",e)}disabled(e){return $.fluent(this,arguments,()=>this.dom.disabled,()=>$.set(this.dom,"disabled",e))}}_.mixin(Qt,D.create("disabled","label"));class Zt extends p{constructor(e){super("textarea",e)}cols(e){return $.fluent(this,arguments,()=>this.dom.cols,()=>$.set(this.dom,"cols",e))}wrap(e){return $.fluent(this,arguments,()=>this.dom.wrap,()=>$.set(this.dom,"wrap",e))}value(e){return $.fluent(this,arguments,()=>this.dom.value,()=>$.set(this.dom,"value",e,t=>{this.on("input",()=>{t.attributes.has(this.dom)!==!1&&t.set(`${this.value()}`)})}))}defaultValue(e){return $.fluent(this,arguments,()=>this.dom.defaultValue,()=>$.set(this.dom,"defaultValue",e))}dirName(e){return $.fluent(this,arguments,()=>this.dom.dirName,()=>$.set(this.dom,"dirName",e))}placeholder(e){return $.fluent(this,arguments,()=>this.dom.placeholder,()=>$.set(this.dom,"placeholder",e))}readOnly(e){return $.fluent(this,arguments,()=>this.dom.readOnly,()=>$.set(this.dom,"readOnly",e))}selectionDirection(e){return $.fluent(this,arguments,()=>this.dom.selectionDirection,()=>$.set(this.dom,"selectionDirection",e))}selectionEnd(e){return $.fluent(this,arguments,()=>this.dom.selectionEnd,()=>$.set(this.dom,"selectionEnd",e))}selectionStart(e){return $.fluent(this,arguments,()=>this.dom.selectionStart,()=>$.set(this.dom,"selectionStart",e))}type(e){return $.fluent(this,arguments,()=>this.dom.type,()=>$.set(this.dom,"type",e))}inputMode(e){return $.fluent(this,arguments,()=>this.dom.inputMode,()=>$.set(this.dom,"inputMode",e))}select(){return this.dom.select(),this}setCustomValidity(e){return this.dom.setCustomValidity(e),this}setRangeText(e,t,s,i){return typeof t=="number"&&typeof s=="number"&&this.dom.setRangeText(e,t,s,i),this.dom.setRangeText(e),this}setSelectionRange(e,t,s){return this.dom.setSelectionRange(e,t,s),this}get labels(){return Array.from(this.dom.labels??[]).map(e=>$(e))}}_.mixin(Zt,D.create("checkValidity","reportValidity","autocomplete","name","form","required","disabled","minLength","maxLength","validationMessage","validity","willValidate"));var pt;class te extends p{constructor(t){super("async",t);U(this,pt,!1)}await(t){return t instanceof Function?t(this).then(s=>this._loaded(s)):t.then(s=>this._loaded(s)),this}_loaded(t){if(B(this,pt,!0),typeof t=="string")this.replace(new Z(t));else if(t instanceof E){const s=new Z(t.toString());t.use(s,"content"),this.replace(s)}else t==null?this.replace(new Z(String(t))):this.replace(t);this.dom.dispatchEvent(new Event("load"))}get loaded(){return I(this,pt)}}pt=new WeakMap;const xe=Object.freeze(Object.defineProperty({__proto__:null,$Async:te},Symbol.toStringTag,{value:"Module"}));class ke extends rt{constructor(e,t){super(e,t)}autoplay(e){return $.fluent(this,arguments,()=>this.dom.autoplay,()=>$.set(this.dom,"autoplay",e))}get buffered(){return this.dom.buffered}controls(e){return $.fluent(this,arguments,()=>this.dom.controls,()=>$.set(this.dom,"controls",e))}crossOrigin(e){return $.fluent(this,arguments,()=>this.dom.crossOrigin,()=>$.set(this.dom,"crossOrigin",e))}get currentSrc(){return this.dom.currentSrc}currentTime(e){return $.fluent(this,arguments,()=>this.dom.currentTime,()=>$.set(this.dom,"currentTime",e))}defaultMuted(e){return $.fluent(this,arguments,()=>this.dom.defaultMuted,()=>$.set(this.dom,"defaultMuted",e))}defaultPlaybackRate(e){return $.fluent(this,arguments,()=>this.dom.defaultPlaybackRate,()=>$.set(this.dom,"defaultPlaybackRate",e))}disableRemotePlayback(e){return $.fluent(this,arguments,()=>this.dom.disableRemotePlayback,()=>$.set(this.dom,"disableRemotePlayback",e))}get duration(){return this.dom.duration}get ended(){return this.dom.ended}get error(){return this.dom.error}loop(e){return $.fluent(this,arguments,()=>this.dom.loop,()=>$.set(this.dom,"loop",e))}mediaKeys(e){return $.fluent(this,arguments,()=>this.dom.mediaKeys,()=>$.set(this.dom,"setMediaKeys",[e]))}muted(e){return $.fluent(this,arguments,()=>this.dom.muted,()=>$.set(this.dom,"muted",e))}get networkState(){return this.dom.networkState}get paused(){return this.dom.paused}playbackRate(e){return $.fluent(this,arguments,()=>this.dom.playbackRate,()=>$.set(this.dom,"playbackRate",e))}get played(){return this.dom.played}preload(e){return $.fluent(this,arguments,()=>this.dom.preload,()=>$.set(this.dom,"preload",e))}preservesPitch(e){return $.fluent(this,arguments,()=>this.dom.preservesPitch,()=>$.set(this.dom,"preservesPitch",e))}get readyState(){return this.dom.readyState}get remote(){return this.dom.remote}get seekable(){return this.dom.seekable}get seeking(){return this.dom.seeking}sinkId(e){return $.fluent(this,arguments,()=>this.dom.sinkId,()=>$.set(this.dom,"setSinkId",[e]))}src(e){return $.fluent(this,arguments,()=>this.dom.src,()=>$.set(this.dom,"src",e))}srcObject(e){return $.fluent(this,arguments,()=>this.dom.srcObject,()=>$.set(this.dom,"srcObject",e))}get textTracks(){return this.dom.textTracks}volume(e){return $.fluent(this,arguments,()=>this.dom.volume,()=>$.set(this.dom,"volume",e))}addTextTrack(e,t,s){return this.dom.addTextTrack(e,t,s)}canPlayType(e){return this.dom.canPlayType(e)}fastSeek(e){return this.dom.fastSeek(e),this}load(){return this.dom.load(),this}pause(){return this.dom.pause(),this}async play(){return await this.dom.play(),this}get isPlaying(){return this.currentTime()>0&&!this.paused&&!this.ended&&this.readyState>2}}class Se extends ke{constructor(e){super("video",e)}disablePictureInPicture(e){return $.fluent(this,arguments,()=>this.dom.disablePictureInPicture,()=>$.set(this.dom,"disablePictureInPicture",e))}height(e){return $.fluent(this,arguments,()=>this.dom.height,()=>$.set(this.dom,"height",e))}width(e){return $.fluent(this,arguments,()=>this.dom.width,()=>$.set(this.dom,"width",e))}playsInline(e){return $.fluent(this,arguments,()=>this.dom.playsInline,()=>$.set(this.dom,"playsInline",e))}poster(e){return $.fluent(this,arguments,()=>this.dom.poster,()=>$.set(this.dom,"poster",e))}get videoHeight(){return this.dom.videoHeight}get videoWidth(){return this.dom.videoWidth}cancelVideoFrameCallback(e){return this.dom.cancelVideoFrameCallback(e),this}getVideoPlaybackQuality(){return this.dom.getVideoPlaybackQuality()}requestPictureInPicture(){return this.dom.requestPictureInPicture()}requestVideoFrameCallback(e){return this.dom.requestVideoFrameCallback(e)}}const kt=class kt extends Xt{constructor(){super(...arguments);l(this,"dom",window)}};l(kt,"$",new kt);let Pt=kt;class Te{constructor(e){l(this,"keyMap",new Map);l(this,"conditional");e.on("keydown",t=>{var s;this.conditional&&!this.conditional(t)||(s=this.keyMap.get(t.key))==null||s.keydown.forEach(i=>i(t))}),e.on("keyup",t=>{var s;this.conditional&&!this.conditional(t)||(s=this.keyMap.get(t.key))==null||s.keyup.forEach(i=>i(t))}),e.on("keypress",t=>{var s;this.conditional&&!this.conditional(t)||(s=this.keyMap.get(t.key))==null||s.keypress.forEach(i=>i(t))})}if(e){return this.conditional=e,this}assigns(e,t,s){e=_.orArrayResolve(e),t=_.orArrayResolve(t);for(const i of e){const n=this.keyMap.get(i)??{keydown:new Set,keypress:new Set,keyup:new Set};for(const o of t)n[o].add(s);this.keyMap.set(i,n)}return this}unassign(e,t,s){e=_.orArrayResolve(e),t=t?_.orArrayResolve(t):["keydown","keypress","keyup"];for(const i of e){const n=this.keyMap.get(i)??{keydown:new Set,keypress:new Set,keyup:new Set};for(const o of t)s?n[o].delete(s):n[o].clear();this.keyMap.set(i,n)}return this}keydown(e,t){return this.assigns(e,"keydown",t),this}keyup(e,t){return this.assigns(e,"keyup",t),this}keypress(e,t){return this.assigns(e,"keypress",t),this}self(e){return e(this),this}}class Ee extends W{constructor(e,t){super(e,t)}}function Oe(r){if(r.$)return r.$;if(r.nodeName.toLowerCase()==="body")return new p("body",{dom:r});if(r.nodeName.toLowerCase()==="head")return new p("head",{dom:r});if(r.nodeName.toLowerCase()==="#document")return ut.from(r);if(r instanceof HTMLElement){const e=$.TagNameElementMap[r.tagName.toLowerCase()],t=e?e===p?new e(r.tagName,{dom:r}):new e({dom:r}):new p(r.tagName,{dom:r});if(t instanceof p)for(const s of Array.from(t.dom.childNodes))t.children.add($(s));return t}else if(r instanceof Text){const e=new Z(r.textContent??"");return e.dom=r,e}else if(r instanceof SVGElement&&r.tagName.toLowerCase()==="svg")return new Ee("svg",{dom:r});throw`$NODE.FROM: NOT SUPPORT TARGET ELEMENT TYPE (${r.nodeName})`}function S(r,...e){if(typeof r>"u"||r===null||r instanceof ot)return r;if(typeof r=="string"){if(r.startsWith("::"))return Array.from(document.querySelectorAll(r.replace(/^::/,""))).map(t=>S(t));if(r.startsWith(":"))return S(document.querySelector(r.replace(/^:/,"")));if(r in S.TagNameElementMap){const t=S.TagNameElementMap[r];return t===rt?new rt(r):t===p?new p(r):new t}else return new p(r)}if(r instanceof Node)return r.$?r.$:Oe(r);if(r instanceof Window)return Pt.$;if(typeof r=="function")return r.prototype&&r.prototype.constructor?new r.prototype.constructor(...e):r(...e);throw new Error(`$(): Target not supported. ${r instanceof Object?r.constructor.name:r}`)}(r=>{r.anchorHandler=null,r.TagNameElementMap={html:p,head:p,document:ut,body:p,a:Gt,p,pre:p,code:p,blockquote:p,strong:p,h1:p,h2:p,h3:p,h4:p,h5:p,h6:p,div:p,ol:p,ul:p,dl:p,li:p,input:M,label:Yt,button:Dt,form:Kt,img:be,dialog:_e,canvas:we,select:qt,option:Jt,optgroup:Qt,textarea:Zt,video:Se,async:te};function e(g,w,x,P){return w.length?(P(),g):x()}r.fluent=e;function t(g,w,x,P){if(x!==void 0){if(x instanceof E){x.use(g,w),g[w]instanceof Function?g[w](...x.value):x.value!==void 0&&(g[w]=x.value),P&&P(x);return}g[w]instanceof Function?g[w](...x):g[w]=x}}r.set=t;function s(g,w){return E.create(g,w)}r.state=s;async function i(g,w){return new Promise(x=>{const P=new FileReader;P.onload=Q=>{const V=r("img");if(V.once("load",yt=>{const R=r("canvas"),K=R.getContext("2d"),Y=V.height()/V.width(),[at,lt]=[Y>1?w/Y:w,Y>1?w:w*Y];R.height(lt).width(at),K==null||K.drawImage(V.dom,0,0,at,lt),x(R.toDataURL(g.type))}),!Q.target)throw"$.resize(): e.target is null";V.src(Q.target.result)},P.readAsDataURL(g)})}r.resize=i;function n(g){const w=new DOMParser().parseFromString(g,"text/html").body;return Array.from(w.children).map(x=>r(x))}r.html=n;function o(g,w){return Object.assign(r.TagNameElementMap,{[g]:w}),r.TagNameElementMap}r.registerTagName=o;function a(g){return g instanceof Array?g:[g]}r.orArrayResolve=a;function c(g,w){return _.mixin(g,w)}r.mixin=c;function h(g=1){return parseInt(getComputedStyle(document.documentElement).fontSize)*g}r.rem=h;function f(g){return g()}r.call=f;function u(){return new H}r.events=u;function d(g){return new ee(g)}r.pointers=d;function m(g){return new Te(g)}r.keys=m;function b(){return new Ie}r.focus=b;function k(...g){return _.classlist(g)}r.classlist=k;function N(...g){return!0}r.pass=N})(S);globalThis.$=S;class Ie extends H{constructor(){super();l(this,"layerMap",new Map);l(this,"currentLayer");l(this,"historyList",[])}layer(t){const s=this.layerMap.get(t)??new Pe(t).on("blur",i=>this.fire("blur",i)).on("focus",i=>this.fire("focus",i));return this.layerMap.set(s.id,s),s}next(){return this.select(0)}prev(){return this.select(1)}up(){return this.select(2)}down(){return this.select(3)}right(){return this.select(4)}left(){return this.select(5)}blur(){var t;return(t=this.currentLayer)==null||t.blur(),this}select(t){var o;if(this.currentLayer=this.currentLayer??[...this.layerMap.values()].at(0),!this.currentLayer)return this;const s=this.currentLayer.currentFocus,i=this.currentLayer.elementSet.array;if(!s){const a=this.currentLayer.beforeBlur??i.at(0);return a?(this.currentLayer.focus(a),this):this}const n=i.indexOf(s);switch(t){case 0:case 1:{let a=t===0?n+1:n-1;(a===i.length&&this.currentLayer.loop()||a===-1&&!this.currentLayer.loop())&&(a=0);const c=i.at(a);if(!c)break;this.currentLayer.focus(c);break}case 3:case 5:case 4:case 2:{const a=s.coordinate();if(!a)break;const c=$.call(()=>{switch(t){case 2:return{y:a.y,x:a.x/2};case 3:return{y:a.y+a.height,x:a.x/2};case 5:return{y:a.y/2,x:a.x};case 4:return{y:a.y/2,x:a.x+a.width}}}),f=(o=i.map(u=>{if(u===s)return;const d=u.coordinate();if(!d)return;const m=$.call(()=>{switch(t){case 2:return{y:d.y+d.height,x:d.x/2};case 3:return{y:d.y,x:d.x/2};case 5:return{y:d.y/2,x:d.x+d.width};case 4:return{y:d.y/2,x:d.x}}});return{$ele:u,elePosition:d,distance:Math.sqrt((m.x-c.x)**2+(m.y-c.y)**2)}}).detype(void 0).filter(({elePosition:u})=>{switch(t){case 2:if(u.y+u.height>=a.y)return!1;break;case 3:if(u.y<=a.y+a.height)return!1;break;case 5:if(u.x+u.width>=a.x)return!1;break;case 4:if(u.x<=a.x+a.width)return!1;break}return!0}).sort((u,d)=>u.distance-d.distance).at(0))==null?void 0:o.$ele;if(!f)break;this.currentLayer.focus(f)}}return this}}class Pe extends H{constructor(t){super();l(this,"id");l(this,"elementSet",new Set);l(this,"entrySet",new Set);l(this,"beforeBlur");l(this,"currentFocus");l(this,"focusHandler",(t,s)=>this.focus(s,!0));l(this,"blurHandler",(t,s)=>this.blur(s));l(this,"__$property__",{loop:!0,scrollThreshold:0});this.id=t,this.add=this.add.bind(this),this.entry=this.entry.bind(this)}add(t){return $.orArrayResolve(t).forEach(s=>{this.elementSet.has(s)||(this.elementSet.add(s),s.tabIndex(0))}),this}remove(t){return this.currentFocus===t&&this.blur(),this.beforeBlur===t&&(this.beforeBlur=void 0),this.elementSet.delete(t),this}entry(t){return $.orArrayResolve(t).forEach(this.entrySet.add.bind(this.entrySet)),this}focus(t,s=!1){if(!t)return this;t.hide(!1);const{scrollTop:i,scrollLeft:n}=document.documentElement,o=$.call(()=>{const h=t.domRect();return{left:h.left+n,top:h.top+i,right:h.right+n,bottom:h.bottom+i,height:h.height,width:h.width}}),{scrollThreshold:a}=this.__$property__,c=this.currentFocus;return this.blur(),this.currentFocus=t,(i>o.top-a||i>o.bottom+a)&&document.documentElement.scrollTo({left:o.left-a,top:o.top-a}),(i+innerHeight<o.top+a||i+innerHeight<o.bottom+a)&&document.documentElement.scrollTo({left:o.left-a,top:o.bottom-innerHeight+a}),t.attribute("focus",""),this.fire("focus",{$prevFocus:c,$focused:t,layer:this}),s||t.trigger("focus"),this}blur(t){return t&&t!==this.currentFocus?this:this.currentFocus?(this.beforeBlur=this.currentFocus,this.currentFocus.attribute("focus",null),this.currentFocus=void 0,this.fire("blur",{$prevFocus:this.beforeBlur,layer:this}),this.beforeBlur.trigger("blur"),this):this}removeAll(){return this.elementSet.forEach(t=>this.remove(t)),this}loop(t){return $.fluent(this,arguments,()=>this.__$property__.loop,()=>$.set(this.__$property__,"loop",t))}scrollThreshold(t){return $.fluent(this,arguments,()=>this.__$property__.scrollThreshold,()=>$.set(this.__$property__,"scrollThreshold",t))}}class ee extends H{constructor(t){super();l(this,"$node");l(this,"map",new Map);this.$node=t,this.$node.on("pointerdown",s=>this.down(s)),this.$node.on("pointerup",s=>this.up(s)),this.$node.on("pointermove",s=>this.move(s)),this.$node.on("pointercancel",s=>this.cancel(s))}down(t){const s=new Me(this,this.toData(t),$(t.target));this.map.set(s.id,s),this.fire("down",s,t)}up(t){const s=this.map.get(t.pointerId);s&&(this.map.delete(t.pointerId),this.fire("up",s,t))}move(t){const s=this.map.get(t.pointerId);s&&(this.map.set(s.id,s),s.update(this.toData(t)),s.direction||(s.move_x>5||s.move_x<-5?s.direction=0:(s.move_y>5||s.move_y<-5)&&(s.direction=1)),this.fire("move",s,t))}cancel(t){const s=this.map.get(t.pointerId);s&&(s.update(this.toData(t)),this.map.delete(s.id),this.fire("cancel",s,t))}toData(t){return{id:t.pointerId,type:t.pointerType,width:t.width,height:t.height,x:t.x,y:t.y}}}class Me{constructor(e,t,s){l(this,"initial_x");l(this,"initial_y");l(this,"movement_x",0);l(this,"movement_y",0);l(this,"$target");l(this,"direction",null);l(this,"manager");Object.assign(this,t),this.manager=e,this.$target=s,this.initial_x=t.x,this.initial_y=t.y}get move_x(){return this.x-this.initial_x}get move_y(){return this.y-this.initial_y}update(e){const t=this.move_x,s=this.move_y;return Object.assign(this,e),this.movement_x=this.move_x-t,this.movement_y=this.move_y-s,this}delete(){return this.manager.map.delete(this.id),this}}var se=(r=>(r[r.Horizontal=0]="Horizontal",r[r.Vertical=1]="Vertical",r))(se||{});Array.prototype.detype=function(...r){return this.filter(e=>{if(r.length)for(const t of r)return typeof e!=typeof t;else return e!==void 0})};Object.defineProperties(Set.prototype,{array:{configurable:!0,get:function(){return Array.from(this)}}});Set.prototype.sort=function(r){return this.array.sort(r)};class ie extends p{constructor(t){super("layout",t);l(this,"_property",{ROW_MAX_HEIGHT:200,GAP:0,IS_RENDERING:!1,RENDER_REQUEST:!1,COLUNM:1,TYPE:"justified",ROOT:null,ITEM_PROPERTIES:new Map});this.style({display:"block",position:"relative"}),new ResizeObserver(s=>{this.inDOM()&&(this.render(),this.dom.dispatchEvent(new Event("resize")))}).observe(this.dom),document.addEventListener("scroll",s=>{s.target===this.root().dom&&this.scrollCompute()},{passive:!0}),new IntersectionObserver(s=>{this.inDOM()&&this.render()}).observe(this.dom)}type(t){return $.fluent(this,arguments,()=>this._property.TYPE,()=>$.set(this._property,"TYPE",t))}maxHeight(t){return $.fluent(this,arguments,()=>this._property.ROW_MAX_HEIGHT,()=>$.set(this._property,"ROW_MAX_HEIGHT",t))}column(t){return $.fluent(this,arguments,()=>this._property.COLUNM,()=>$.set(this._property,"COLUNM",t))}gap(t){return $.fluent(this,arguments,()=>this._property.GAP,()=>$.set(this._property,"GAP",t))}root(t){return $.fluent(this,arguments,()=>this._property.ROOT??$(document),()=>$.set(this._property,"ROOT",t))}get COL_WIDTH(){return(this.offsetWidth-this._property.GAP*(this._property.COLUNM-1))/this._property.COLUNM}justifiedCompute(){const t=[],s=this.offsetWidth;for(const i of this.children.array){const n=$(i);if(!(n instanceof W))continue;const o=n.attribute("layout-item-ratio"),a=o?parseFloat(o):n.dom.offsetWidth/n.dom.offsetHeight,c={$node:n,ratio:a};let h=t.at(-1);(!h||h.height<this._property.ROW_MAX_HEIGHT)&&(h={height:0,items:[],ratio:0},t.push(h));let f=0;h.items.forEach(m=>f+=m.ratio);const u=f+a,d=(s-this._property.GAP*h.items.length)/u;h.items.push(c),h.ratio=u,h.height=d}return t}waterfallCompute(){const t=[],s=this.COL_WIDTH,i=()=>{if(t.length<this._property.COLUNM){const n={items:[],ratio:0,height:0};return t.push(n),n}return[...t].sort((n,o)=>n.height-o.height)[0]};for(const n of this.children.array){const o=$(n);if(!(o instanceof W))continue;const a=o.attribute("layout-item-ratio"),c=a?parseFloat(a):o.dom.offsetWidth/o.dom.offsetHeight,h={$node:o,ratio:c},f=i();let u=0;f.items.forEach(b=>u+=b.ratio);const d=s/(f.height+s/c),m=s/d;f.items.push(h),f.ratio=d,f.height=m}return t}render(){if(!this.inDOM())return this;if(this.events.fire("beforeRender"),this._property.ITEM_PROPERTIES.clear(),this._property.TYPE==="justified"){const t=this.justifiedCompute();let s=0;for(const i of t){let n=0;i.height>this._property.ROW_MAX_HEIGHT&&(i.height=this._property.ROW_MAX_HEIGHT);for(const o of i.items){const a=o.ratio*i.height;o.$node.style({position:"absolute",height:`${i.height}px`,width:`${a}px`,top:`${s}px`,left:`${n}px`}),o.$node.attribute("layout-item-ratio",o.ratio),this._property.ITEM_PROPERTIES.set(o.$node,{height:i.height,width:a,top:s,left:n,ratio:o.ratio,$node:o.$node}),o.$node.coordinate({x:n,y:s,height:i.height,width:a}),n+=i.height*o.ratio+this._property.GAP}s+=i.height+this._property.GAP}this.style({height:`${s}px`})}else if(this._property.TYPE="waterfall"){const t=this.waterfallCompute(),s=this.COL_WIDTH;let i=0;for(const n of t){let o=0;for(const a of n.items){const c=s/a.ratio;a.$node.style({position:"absolute",height:`${c}px`,width:`${s}px`,top:`${o}px`,left:`${i}px`}),a.$node.attribute("layout-item-ratio",a.ratio),this._property.ITEM_PROPERTIES.set(a.$node,{height:c,width:s,top:o,left:i,ratio:a.ratio,$node:a.$node}),a.$node.coordinate({x:i,y:o,height:c,width:s}),o+=c+this._property.GAP}i+=s+this._property.GAP}if(t.length){const n=t.sort((o,a)=>a.height-o.height)[0];this.style({height:`${n.height+n.items.length*this._property.GAP}px`})}else this.style({height:""})}return this.scrollCompute(),this.events.fire("afterRender"),this}scrollCompute(){if(this.inDOM()===!1)return;const t=document.documentElement.scrollTop-this.dom.offsetTop;this._property.ITEM_PROPERTIES.forEach((s,i)=>{const n=s.top,o=s.top+s.height;i.attribute("focus")===""||document.activeElement===i.dom||(o>t&&n<t+innerHeight+s.height?i.hide(!1,!1):i.hide(!0,!1))}),this.children.render()}}$.registerTagName("layout",ie);class re extends p{constructor(t){super("view",t);l(this,"viewCache",new Map);l(this,"contentId",null)}setView(t,s){return this.viewCache.set(t,s),this}deleteView(t){return this.viewCache.delete(t),this}deleteAllView(){return this.viewCache.clear(),this}switchView(t){if(t===this.contentId)return this;const s=this.viewCache.get(t);if(s===void 0)return this;const i=this.currentContent;let n=!1;this.contentId=t;const o=()=>{this.events.fire("rendered",{$view:this,previousContent:i,nextContent:s})},a=()=>{this.events.fire("afterSwitch",{$view:this,previousId:t})};return this.events.fire("beforeSwitch",{$view:this,preventDefault:()=>n=!0,targetId:t,previousContent:i,nextContent:s,switched:a,rendered:o}),n||(this.content(s),o(),a()),this}get currentContent(){if(this.contentId)return this.viewCache.get(this.contentId)}}$.registerTagName("view",re);var G;const v=class v extends re{constructor(t){super({tagname:"router",...t});U(this,G,"");l(this,"routes",new Map);v.routers.add(this)}base(t){return $.fluent(this,arguments,()=>I(this,G),()=>{B(this,G,t??I(this,G))})}map(t){t=$.orArrayResolve(t);for(const s of t)s instanceof Array?this.map(s):this.routes.set(s.path(),s);return this.resolve(),this}resolve(){return new Promise(t=>{var b;if(!location.pathname.startsWith(I(this,G)))return t(2);const s=location.pathname.replace(I(this,G),"/").replace("//","/"),i=s.split("/").map(k=>`/${k}`),n=location.search,o=new Map(n.replace("?","").split("&").map(k=>k.split("="))),c=(()=>{const k=[];for(const[N,g]of this.routes){const w=$.orArrayResolve(N);for(const x of w){let P=0,Q={},V={};const yt=x.split("/").map(R=>`/${R}`);if(!(i.length<yt.length)){for(let R=0;R<yt.length;R++){const[K,Y]=yt[R].split("?");if(Y&&Y.split("&").forEach(at=>{const lt=o.get(at);lt!==void 0&&P++,Object.assign(V,{[at]:lt})}),K.startsWith("/:")){P++,Object.assign(Q,{[K.replace("/:","")]:i[R].replace("/","")});continue}else if(x.startsWith("#")&&x===location.hash){P++;continue}else if(K===i[R]){P++;continue}else break}k.push({deep:P,$route:g,params:Q,query:V,routePath:x,pathId:g.static()?Object.keys(V).length!==0?s+n:Object.keys(Q).length!==0?s:w[0]:w[0]})}}}return k.sort((N,g)=>g.deep-N.deep).at(0)})();if(!c)return t(1);const{$route:h,params:f,pathId:u,query:d}=c;if(h.static()&&u===this.contentId)return t(0);this.events.once("rendered",({nextContent:k,previousContent:N})=>{N==null||N.events.fire("afterShift",N),k.events.fire("rendered",k),t(0)});const m=this.viewCache.get(u)??h.build({params:f,query:d});m.params=f,m.query=d,this.viewCache.has(u)||this.setView(u,m),this.events.once("beforeSwitch",()=>{var k;m.events.fire("beforeShift",m),(k=this.currentContent)==null||k.events.fire("beforeShift",this.currentContent)}),this.events.once("afterSwitch",()=>m.events.fire("afterShift",m)),(b=this.currentContent)==null||b.events.fire("close",this.currentContent),m.events.fire("open",m),this.switchView(u)})}static init(){if(!history.state||!("index"in history.state)){const t={index:v.index};history.replaceState(t,"")}else v.index=history.state.index;return v.navigationDirection=0,v.resolve(),window.addEventListener("popstate",()=>v.popstate()),window.addEventListener("scroll",()=>{this.setScrollHistory(this.index,location.href,document.documentElement.scrollTop)},{passive:!0}),history.scrollRestoration="manual",this}static open(t,s){return t===void 0?this:(t=this.urlResolver(t),t.href===this.url.href?this:t.origin!==this.url.origin?(window.open(t,s),this):(v.clearForwardScrollHistory(),v.forwardIndex=0,v.index++,history.pushState(v.historyState,"",t),v.stateChange(0),v.resolve(),this))}static back(){return history.back(),this}static forward(){return this.forwardIndex===0?this:(history.forward(),this)}static replace(t){return t===void 0?this:(t=this.urlResolver(t),history.replaceState(v.historyState,"",t),this.stateChange(2),this.setScrollHistory(this.index,location.href,0),v.resolve(),this)}static urlResolver(t){return t instanceof URL?t:(t.startsWith("/")&&(t=`${location.origin}${t}`),t.startsWith("#")&&(t=`${location.origin}${location.pathname}${t}`),new URL(t))}static popstate(){const t=history.state.index>v.index?0:history.state.index<v.index?1:2;t===0?this.forwardIndex--:t===1&&this.forwardIndex++,v.index=history.state.index,v.stateChange(t),v.resolve()}static async resolve(){await Promise.all([...v.routers.values()].map(t=>t.resolve())),this.scrollRestoration(),this.setScrollHistory(this.index,location.href,document.documentElement.scrollTop)}static get historyState(){return{index:v.index}}static stateChange(t){const s=this.url,i=new URL(location.href);this.url=i,v.events.fire("stateChange",{beforeURL:s,afterURL:i,direction:t}),v.navigationDirection=t}static setScrollHistory(t,s,i){const n=this.getScrollHistory();if(!n)return sessionStorage.setItem(this.scrollHistoryKey,JSON.stringify({[t]:{url:s,value:i}}));n[t]={url:s,value:i},sessionStorage.setItem(this.scrollHistoryKey,JSON.stringify(n))}static getScrollHistory(){const t=sessionStorage.getItem(this.scrollHistoryKey);if(t)return JSON.parse(t)}static clearForwardScrollHistory(){const t=this.getScrollHistory();if(t)for(const s in t)Number(s)>this.index&&delete t[s],sessionStorage.setItem(this.scrollHistoryKey,JSON.stringify(t))}static scrollRestoration(){const t=this.getScrollHistory();if(t&&t[this.index])document.documentElement.scrollTop=t[this.index].value??0;else if(location.hash.length){const s=$(document.body).$(`:${location.hash}`);s&&(document.documentElement.scrollTop=s.dom.offsetTop)}else document.documentElement.scrollTop=0}};G=new WeakMap,l(v,"routers",new Set),l(v,"events",new H),l(v,"navigationDirection"),l(v,"index",0),l(v,"forwardIndex",0),l(v,"url",new URL(location.href)),l(v,"scrollHistoryKey","$ROUTER_SCROLL_HISTORY");let O=v;var q=(r=>(r[r.Forward=0]="Forward",r[r.Back=1]="Back",r[r.Replace=2]="Replace",r))(q||{});O.init();class Le extends p{constructor(t,s,i){super("page");l(this,"rendered",!1);l(this,"$route");l(this,"params");l(this,"query");l(this,"$page",this);this.$route=t,this.params=s,this.query=i}render(){const t=this.$route.builder();if(t){const s=t(this);s instanceof Promise?s.then(i=>i===this?void 0:this.content(i)):s===this||this.content(s)}return this.rendered=!0,this}}var et,mt;class Ae extends W{constructor(t){super("route",t);U(this,et,"");U(this,mt);l(this,"rendered",!1);l(this,"options",{static:!0})}path(t){return $.fluent(this,arguments,()=>I(this,et),()=>B(this,et,t??I(this,et)))}static(t){return $.fluent(this,arguments,()=>this.options.static,()=>$.set(this.options,"static",t))}builder(t){return arguments.length?(B(this,mt,t),this):I(this,mt)}build(t){return new Le(this,t.params,t.query).render()}}et=new WeakMap,mt=new WeakMap;class ne extends Gt{constructor(e){super(e),Object.assign(this.__$property__,{preventDefault:!1}),this.on("click",t=>{t.preventDefault(),this.__$property__.preventDefault||$.open(this.href(),this.target())})}preventDefault(e){return $.fluent(this,arguments,()=>this.__$property__.preventDefault,()=>$.set(this.__$property__,"preventDefault",e))}}$.registerTagName("router",O);$.registerTagName("route",Ae);$.registerTagName("ra",ne);Object.assign($,{open(r,e){return O.open(r,e)},replace(r){return O.replace(r)},back(){return O.back()},forward(){return O.forward()}});const It={h:"height",w:"width",m:"margin",mX:"margin-inline",mXS:"margin-inline-start",mXE:"margin-inline-end",mY:"margin-block",mYS:"margin-block-start",mYE:"margin-block-end",mT:"margin-top",mB:"margin-bottom",mL:"margin-left",mR:"margin-right",mType:"margin-type",p:"padding",pX:"padding-inline",pXS:"padding-inline-start",pXE:"padding-inline-end",pY:"padding-block",pYS:"padding-block-start",pYE:"padding-block-end",pT:"padding-top",pB:"padding-bottom",pL:"padding-left",pR:"padding-right",...C("b",""),...C("bT","top"),...C("bB","bottom"),...C("bL","left"),...C("bR","right"),...C("bX","block"),...C("bXS","block-start"),...C("bXE","block-end"),...C("bY","inline"),...C("bTS","inline-start"),...C("bYE","inline-end"),bRadius:"border-radius",bColor:"border-color",bTLRadius:"border-top-left-radius",bTRRadius:"border-top-left-radius",bBLRadius:"border-bottom-left-radius",bBRRadius:"border-bottom-right-radius",bEERadius:"border-end-end-radius",bESRadius:"border-end-start-radius",bCollapse:"border-collapse",bImg:"border-image",bImgOutset:"border-image-outset",bImgRepeat:"border-image-repeat",bImgSlice:"border-image-slice",bImgSource:"border-image-source",bImgWidth:"border-image-width",bSpacing:"border-spacing",align:"align-content",alignItems:"align-items",alignSelf:"align-self",all:"all",accentColor:"accent-color",a:"animation",aComposition:"animation-composition",aDelay:"animation-delay",aDirection:"animation-direction",aDuration:"animation-duration",aFillmode:"animation-fill-mode",aIteration:"animation-iteration-count",aName:"animation-name",aPlaystate:"animation-play-state",aRange:"animation-range",aRangeend:"animation-range-end",aRangestart:"animation-range-start",aTimeline:"animation-timeline",aTiming:"animation-timing-function",anchor:"anchor-name",appearance:"appearance",aspect:"aspect-ratio",backdrop:"backdrop-filter",backface:"backface-visibility",bg:"background",bgAttachment:"background-attachment",bgBlendmode:"background-blend-mode",bgClip:"background-clip",bgColor:"background-color",bgImage:"background-image",bgOrigin:"background-origin",bgPosition:"background-position",bgX:"background-position-x",bgY:"background-position-y",bgRepeat:"background-repeat",bgSize:"background-size",blocksize:"block-size",bottom:"bottom",shadow:"box-shadow",sizing:"box-sizing",decoration_break:"box-decoration-break",breakAfter:"breakafter",breakBefore:"breakbefore",breakInside:"breakinside",captionSize:"caption-szie",caretColor:"caret-color",clear:"clear",clipPath:"clip-path",clipRule:"clip-rule",color:"color",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorScheme:"color-scheme",colCount:"column-count",colFill:"column-fill",colGap:"column-gap",colRule:"column-rule",colRuleColor:"column-rule-color",colRuleStyle:"column-rule-style",colRuleWidth:"column-rule-width",colSpan:"column-span",colWidth:"column-width",cols:"columns",contain:"contain",containIntrinsicBlock_size:"contain-intrinsic-block-size",containIntrinsicHeight:"contain-intrinsic-height",containIntrinsicInline_size:"contain-intrinsic-inline-size",containIntrinsicSize:"contain-intrinsic-size",containIntrinsicWidth:"contain-intrinsic-width",container:"container",containerName:"container-name",containerType:"container-type",content:"content",contentVisibility:"content-visibility",counterIncrement:"counter-increment",counterReset:"counter-reset",counterSet:"counter-set",cursor:"cursor",cx:"cx",cy:"cy",d:"d",dir:"direction",display:"display",dominantBaseline:"dominant-baseline",emptyCells:"empty-cells",fieldSizing:"fieldsizing",fill:"fill",fillOpacity:"fill-opacity",fillRule:"fill-rule",filter:"filter",flex:"flex",flexBasis:"flex-basis",flexDir:"flex-direction",flexFlow:"flex-flow",flexGrow:"flex-grow",flexShrink:"flex-shrink",flexWrap:"flex-wrap",float:"float",floodColor:"flood-color",floodOpacity:"flood-opacity",font:"font",fontFamily:"font-family",fontFeature:"font-feature-settings",fontKerning:"font-kerning",fontLang:"font-language-override",fontOptical:"font-optical-sizing",fontPalette:"font-palette",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontSmooth:"font-smooth",fontStretch:"font-stretch",fontStyle:"font-style",fontSynth:"font-synthesis",fontSynthPosition:"font-synthesis",fontSynthSmallcaps:"font-synthesis-small-caps",fontSynthStyle:"font-synthesis-style",fontSynthWeight:"font-synthesis-weight",fontVar:"font-variant",fontVarAlter:"font-variant-alternates",fontVarCaps:"font-variant-caps",fontVarEA:"font-variant-east-asian",fontVarEmoji:"font-variant-emoji",fontVarLigatures:"font-variant-ligatures",fontVarNum:"font-variant-numeric",fontVarPos:"font-variant-position",fontVarSettings:"font-variant-settings",fontWeight:"font-weight",forcedColor:"forced-color-adjust",gap:"gap",g:"grid",gArea:"grid-area",gAutoCol:"grid-auto-col",gAutoRows:"grid-auto-rows",gCol:"grid-column",gColEnd:"grid-column-end",gColStart:"grid-column-start",gRow:"grid-row",gRowEnd:"grid-row-end",gRowStart:"grid-row-start",gTemplate:"grid-template",gTemplateAreas:"grid-template-areas",gTemplateCol:"grid-template-columns",gTemplateRow:"grid-template-rows",hanging:"hanging-punctuation",hyp:"hyphenate",hypChar:"hyphenate-character",hypLimitChars:"hyphenate-limit-chars",hyps:"hyphens",imgOrientation:"image-orientation",imgRendering:"image-rendering",imgResolution:"image-resolution",initLetter:"initial-letter",inlineSize:"inline-size",inset:"inset",insetY:"inset-block",insetyE:"inset-block-end",insetyS:"inset-block-start",insetX:"inset-inline",insetXE:"inset-inline-end",insetXS:"inset-inline-start",interPolate:"interpolate-size",isolation:"isolation",justify:"justify-content",justifyItems:"justify-items",justifySelf:"justify-self",left:"left",letterSpacing:"letter-spacing",lighting:"lighting-color",lineBreak:"line-break",lineHeight:"line-height",lineHeightStep:"line-height-step",list:"list-style",listImg:"list-style_image",listPos:"list-style-position",listType:"list-style-type",marker:"marker",markerE:"marker-end",markerM:"marker-mid",markerS:"marker-start",mask:"mask",maskB:"mask-border",maskBMode:"mask-border-mode",maskBOutset:"mask-border-outset",maskBRepeat:"mask-border-repeat",maskBSlice:"mask-border-slice",maskBSource:"mask-border-source",maskBWidth:"mask-border-width",maskClip:"mask-clip",maskComposite:"mask-composite",maskimg:"mask-image",maskMode:"mask-mode",maskPos:"mask-position",maskOrigin:"mask-origin",maskRepeat:"mask-repeat",maskSize:"mask-size",maskType:"mask-type",mathDepth:"math-depth",mathShift:"math-shift",mathStyle:"math-style",maxY:"max-block-size",maxH:"max-height",maxX:"max-inline-size",maxW:"max-width",minY:"min-block-size",minH:"min-height",minX:"min-inline-size",minW:"min-width",mix:"mix-blend-mode",objFit:"object-fit",objPos:"object-position",offset:"offset",offsetAnchor:"offset-anchor",offsetDist:"offset-distance",offsetPath:"offset-path",offsetPos:"offset-position",offsetRot:"offset-rotate",o:"opacity",order:"order",orphans:"orphans",outline:"outline",outlineColor:"outline-color",outlineOffset:"outline-offset",outlineStyle:"outline-style",outlineWidth:"outline-width",overflow:"overflow",overflowAnchor:"overflow-anchor",overflowClip:"overflow-clip-margin",overflowInline:"overflow-inline",overflowWrap:"overflow-wrap",overflowX:"overflow-x",overflowY:"overflow-y",overlay:"overlay",overscrollBehavior:"overscroll-behavior",overscrollBlock:"overscroll-behavior-block",overscrollInline:"overscroll-behavior-inline",overscrollX:"overscroll-behavior-x",overscrollY:"overscroll-behavior-y",page:"page",paintOrder:"paint-order",perspective:"perspective",perspectiveOrigin:"perspective-origin",place:"place-content",placeItems:"place-items",placeSelf:"place-self",pointer:"pointer-events",pos:"position",posAnchor:"position-anchor",posArea:"position-area",posTry:"position-try",posTryFallbacks:"position-try-fallbacks",posTryOrder:"position-try-order",posVisibility:"position-visibility",printColor:"print-color-adjust",quotes:"quotes",r:"r",resize:"resize",right:"right",rot:"rotate",rowGap:"row-gap",rubyAlign:"ruby-align",rubyPos:"ruby-position",rx:"rx",ry:"ry",scale:"scale",scrollBehavior:"scroll-behavior",scrollM:"scroll-margin",scrollMX:"scroll-margin-inline",scrollMXE:"scroll-margin-inline-end",scrollMXS:"scroll-margin-inline-start",scrollMY:"scroll-margin-block",scrollMYE:"scroll-margin-block-end",scrollMYS:"scroll-margin-block-start",scrollML:"scroll-margin-left",scrollMR:"scroll-margin-right",scrollMT:"scroll-margin-top",scrollMB:"scroll-margin-bottom",scrollPY:"scroll-padding-block",scrollPYS:"scroll-padding-block-start",scrollPYE:"scroll-padding-block-end",scrollPX:"scroll-padding-inline",scrollPXS:"scroll-padding-inline-start",scrollPXE:"scroll-padding-inline-end",scrollPL:"scroll-padding-left",scrollPR:"scroll-padding-right",scrollPT:"scroll-padding-top",scrollPB:"scroll-padding-bottom",scrollSnapAlign:"scroll-snap-align",scrollSnapType:"scroll-snap-type",scrollTimeline:"scroll-timeline",scrollTimelineAxis:"scroll-timeline-axis",scrollTimelineName:"scroll-timeline-name",scrollbarColor:"scrollbar-color",scrollbarGutter:"scrollbar-gutter",scrollbarWidth:"scrollbar-width",shapeImgThreshold:"shape-image-threshold",shapeMargin:"shape-margin",shapeOutside:"shape-outside",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",stroke:"stroke",strokeDashArray:"stroke-dash-array",strokeDashOffset:"stroke-dashoffset",strokeLinecap:"stroke-linecap",strokeLinejoin:"stroke-linejoin",strokeMiterlimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabSize:"tab-size",tableLayout:"table-layout",txtAlign:"text-align",txtAlignLast:"text-align-last",txtAnchor:"text-anchor",txtCombineUpright:"text-combine-upright",txtDecor:"text-decoration",txtDecorColor:"text-decoration-color",txtDecorLine:"text-decoration-line",txtDecorSkip:"text-decoration-skip",txtDecorSkipInk:"text-decoration-skip-ink",txtDecorStyle:"text-decoration-style",txtDecorThickness:"text-decoration-thickness",txtEmp:"text-emphasis",txtEmpColor:"text-emphasis-color",txtEmpPos:"text-emphasis-position",txtEmpStyle:"text-emphasis-style",txtIndent:"text-indent",txtJustify:"text-justify",txtOrientation:"text-orientation",txtOverflow:"text-overflow",txtRendering:"text-rendering",txtShadow:"text-shadow",txtSizeAdjust:"text-size-adjust",txtSpacingTrim:"text-size-trim",txtTransform:"text-transform",txtUnderlineOffset:"text-underline-offset",txtUnderlinePosition:"text-underline-position",txtWrap:"text-wrap",txtWrapMode:"text-wrap-mode",textWrapStyle:"text-wrap-style",timelineScope:"timeline-scope",top:"top",touchAction:"touch-action",transform:"transform",tOrigin:"transform-origin",tStyle:"transform-style",transition:"transition",tBehavior:"transition-behavior",tDelay:"transition-delay",tDuration:"transition-duration",tProperty:"transition-property",tTiming:"transition-timing-function",translate:"translate",unicodeBldi:"unicode-bldi",userSelect:"user-select",vectorEffect:"vector-effect",vectorAlign:"vector-align",viewTimeline:"view-timeline",viewTimelineAxis:"view-timeline-aixs",viewTimelineInset:"view-timeline-inset",viewTimelineName:"view-timeline-name",viewTransitionName:"view-transition-name",visibility:"visibility",whiteSpace:"white-space",whiteSpaceCollapse:"white-space-collapse",widows:"widows",willChange:"will-change",wordBreak:"word-break",wordSpacing:"word-spacing",writingMode:"writing-mode",x:"x",y:"y",z:"z-index",zoom:"zoom"};function C(r,e){return Object.fromEntries(["","color","width","style"].map(t=>[`${r}${t}`,`border${e.length?`-${e}`:""}${t.length?`-${t}`:""}`]))}const $t=new CSSStyleSheet;$t.insertRule("@layer media {}");$t.insertRule("@layer base {}");$t.insertRule("@layer selector {}");document.adoptedStyleSheets.push($t);const A=class A{static insertRule(e,t){var u;const s=this.getSelector(this.analysis(e,t)),i=s.filter(d=>d.type==="SELECTOR"),n=s.filter(d=>d.type==="CHILDREN"),o=s.filter(d=>d.value!==""&&d.type==="PROPERTY"),a=s.filter(d=>d.value===""),c=n.map(d=>this.childrenRuleHandler(d));for(const d of i)this.selectorRuleHandler(d);for(const d of o){const m=`${d.selector} { ${It[d.decodedKey]}: ${d.value} }`;if(d.atRules.length){let b="_REPLACE_";for(const k of d.atRules)b=b.replace("_REPLACE_",`${k} { _REPLACE_ }`);if(b=b.replace("_REPLACE_",m),this.ruleSet.has(b))continue;this.ruleSet.add(b),this.cssStyleSheet.insertRule(b,0)}else{if(this.ruleSet.has(m))continue;this.ruleSet.add(m),this.layer_base.insertRule(m,0)}}if(!t)return;const h=((u=this.elementMap.get(t))==null?void 0:u.styleMap)??new Map;this.elementMap.set(t,{$ele:t,styleMap:h}),c.forEach(d=>{t.addStaticClass(...d)}),e.selector&&e.selector.startsWith(".")&&!e.selector.includes(" ")&&t.addStaticClass(`${e.selector.replace(".","")}`),o.forEach(d=>{const m=h==null?void 0:h.get(d.cachedname);t.removeStaticClass(m),h==null||h.set(d.cachedname,d.classname),t==null||t.addStaticClass(d.classname)}),a.forEach(d=>{t==null||t.removeStaticClass(h==null?void 0:h.get(d.cachedname))})}static selectorRuleHandler(e,t=""){if(e.type==="SELECTOR"){t=t+e.selector;let s=`${t} { _REPLACE_ }`;for(const i of e.value){if(i.type!=="PROPERTY"){this.selectorRuleHandler(i,t);continue}s=s.replace("_REPLACE_",`${It[i.decodedKey]??i.decodedKey}: ${i.value}; _REPLACE_`)}if(s=s.replace("_REPLACE_",""),this.paramSet.has(s))return;this.layer_selector.insertRule(s,0),this.paramSet.add(s)}else if(e.type==="PSEUDO_CLASS"||e.type==="PSEUDO_ELEMENT"){t=`${t}${e.key.replaceAll("$",":")}`;let s=`${t} { _REPLACE_ }`;for(const i of e.value){if(i.type!=="PROPERTY"){this.selectorRuleHandler(i,t);continue}s=s.replace("_REPLACE_",`${It[i.decodedKey]}: ${i.value}; _REPLACE_`)}if(s=s.replace("_REPLACE_",""),this.paramSet.has(s))return;this.layer_selector.insertRule(s,0),this.paramSet.add(s)}else e.type==="CHILDREN"&&this.childrenRuleHandler(e,t)}static childrenRuleHandler(e,t=""){const s=[];for(const i of e.value)s.push(`{${t}${i.selector}}`),this.selectorRuleHandler(i,"."+`\\{${t}${i.selector}\\}${e.selector} `.replaceAll(".","\\."));return s}static getSelector(e,t="",s="",i=[]){const n=[];for(const o of e){if(o.type==="SELECTOR"){n.push({...o,atRules:i,classname:`${t}{${o.selector}}`,selector:`${t}${o.selector}${s}`,cachedname:""});continue}if(o.type==="CHILDREN"){n.push({...o,atRules:i,classname:`${s}`,selector:`${s}`,cachedname:""});continue}if(o.type==="AT_RULE")n.push(this.getSelector(o.value,`${t}${o.key}-${o.data.query.replaceAll(" ","")}:`,`${s}`,[...i,`${Wt[o.decodedKey]} ${o.data.query}`]));else if(o.type==="PSEUDO_CLASS")n.push(this.getSelector(o.value,`${t}${o.key}:`,`${s}${Vt[o.decodedKey]}`,i));else if(o.type==="PSEUDO_ELEMENT")n.push(this.getSelector(o.value,`${t}${o.key}:`,`${s}${zt[o.decodedKey]}`,i));else if(o.type==="PROPERTY"){const a=`${t}${o.key}`.replaceAll(" ","_"),c=`${o.value}`.replaceAll(" ","_");n.push({...o,atRules:i,classname:`${a}:${c}`,selector:"."+`${a}:${c}`.replaceAll(/[$.:%()#]/g,(h,f)=>`\\${h}`)+`${s}`,cachedname:a})}}return n.flat()}static analysis(e,t){const s=[];if(e.selector){const{selector:i,...n}=e;return s.push({type:"SELECTOR",value:this.analysis(n),key:"selector",decodedKey:"selector",selector:i}),s}for(const[i,n]of Object.entries(e)){if(n===void 0)continue;const o=i.replaceAll(/\$/g,"");if(o==="children"){const a=n;s.push({type:"CHILDREN",value:a.map(c=>this.analysis(c).at(0)),decodedKey:o,key:i})}else if(o in Wt){const{query:a,...c}=n;s.push({type:"AT_RULE",value:this.analysis(c),key:i,decodedKey:o,data:{query:a}})}else i.match(/^\$[^$]/)&&o in Vt?s.push({type:"PSEUDO_CLASS",value:this.analysis(n),key:i,decodedKey:o}):i.match(/^\$\$[^$]/)&&o in zt?s.push({type:"PSEUDO_ELEMENT",value:this.analysis(n),key:i,decodedKey:o}):(n instanceof E&&t&&n.on("update",()=>{var a;return t.css({[i]:(a=n.value)==null?void 0:a.toString()})}),s.push({type:"PROPERTY",value:n instanceof E?n.value.toString():n.toString(),key:i,decodedKey:o}))}return s}static propertyToClass(e,t){return`${e.replaceAll("_","-")}-${t}`}static getClasses(e,t=""){return Object.entries(e).map(([s,i])=>i instanceof Object?this.getClasses(i,`${t}${s}:`):this.propertyToClass(`${t.length?`${t}`:""}${s}`,i)).flat()}};l(A,"elementMap",new Map),l(A,"ruleSet",new Set),l(A,"cssStyleSheet",$t),l(A,"layer_selector",A.cssStyleSheet.cssRules[0]),l(A,"layer_base",A.cssStyleSheet.cssRules[1]),l(A,"layer_media",A.cssStyleSheet.cssRules[2]),l(A,"paramSet",new Set);let dt=A;const Vt={active:":active",anyLink:":any-link",autoFill:":auto-fill",checked:":checked",default:":default",defined:":defined",disabled:":disabled",empty:":empty",first:":first",firstChild:":first-child",firstOfType:"first-of-type",focus:":focus",focusVisible:":focus-visible",focusWithin:":focus-within",hover:":hover",inRange:":in-range",indeterminate:":indeterminate",invalid:":invalid",lastChild:":last-child",lastOfType:":last-of-type",left:":left",link:":link",modal:":modal",onlyChild:":only-child",onlyOfType:":only-of-type",optional:":optional",outOfRange:":out-of-range",placeholderShown:":placeholder-shown",popoverOpen:":popover-open",readOnly:":read-only",readWrite:":read-write",required:":required",right:":right",root:":root",scope:":scope",target:":target",userInvalid:":user-invalid",userValid:":user-valid",valid:":valid",visited:":visited"},zt={after:"::after",backdrop:"::backdrop",before:"::before",fileSelectorButton:"::fileSelectorButton",fileLetter:"::file-letter",firstLine:"::file-line",grammarError:"::grammarError",marker:"::marker",placeholder:"::placeholder",selection:"::selection",spellingError:"::spelling-error",viewTransition:"::view-transition",viewTransitionGroup:"::view-transition-group",viewTransitionImagePair:"::view-transition-image-pair",viewTransitionNew:"::view-transition-new",viewTransitionOld:"::view-transition-old"},Wt={charset:"@charset",container:"@container",counterStyle:"@counter-style",fontFace:"@font-face",fontPaletterValues:"@font-paletter-values",import:"@import",keyframes:"@keyframes",layer:"@layer",media:"@media",namespace:"@namespace",page:"@page",property:"@property",scope:"@scope",startingStyle:"@starting-style",supports:"@supports"},Re={slate:{50:"#f8fafc",100:"#f1f5f9",200:"#e2e8f0",300:"#cbd5e1",400:"#94a3b8",500:"#64748b",600:"#475569",700:"#334155",800:"#1e293b",900:"#0f172a",950:"#020617"},gray:{50:"#f9fafb",100:"#f3f4f6",200:"#e5e7eb",300:"#d1d5db",400:"#9ca3af",500:"#6b7280",600:"#4b5563",700:"#374151",800:"#1f2937",900:"#111827",950:"#030712"},zinc:{50:"#fafafa",100:"#f4f4f5",200:"#e4e4e7",300:"#d4d4d8",400:"#a1a1aa",500:"#71717a",600:"#52525b",700:"#3f3f46",800:"#27272a",900:"#18181b",950:"#09090b"},neutral:{50:"#fafafa",100:"#f5f5f5",200:"#e5e5e5",300:"#d4d4d4",400:"#a3a3a3",500:"#737373",600:"#525252",700:"#404040",800:"#262626",900:"#171717",950:"#0a0a0a"},stone:{50:"#fafaf9",100:"#f5f5f4",200:"#e7e5e4",300:"#d6d3d1",400:"#a8a29e",500:"#78716c",600:"#57534e",700:"#44403c",800:"#292524",900:"#1c1917",950:"#0c0a09"},red:{50:"#fef2f2",100:"#fee2e2",200:"#fecaca",300:"#fca5a5",400:"#f87171",500:"#ef4444",600:"#dc2626",700:"#b91c1c",800:"#991b1b",900:"#7f1d1d",950:"#450a0a"},orange:{50:"#fff7ed",100:"#ffedd5",200:"#fed7aa",300:"#fdba74",400:"#fb923c",500:"#f97316",600:"#ea580c",700:"#c2410c",800:"#9a3412",900:"#7c2d12",950:"#431407"},amber:{50:"#fffbeb",100:"#fef3c7",200:"#fde68a",300:"#fcd34d",400:"#fbbf24",500:"#f59e0b",600:"#d97706",700:"#b45309",800:"#92400e",900:"#78350f",950:"#451a03"},yellow:{50:"#fefce8",100:"#fef9c3",200:"#fef08a",300:"#fde047",400:"#facc15",500:"#eab308",600:"#ca8a04",700:"#a16207",800:"#854d0e",900:"#713f12",950:"#422006"},lime:{50:"#f7fee7",100:"#ecfccb",200:"#d9f99d",300:"#bef264",400:"#a3e635",500:"#84cc16",600:"#65a30d",700:"#4d7c0f",800:"#3f6212",900:"#365314",950:"#1a2e05"},green:{50:"#f0fdf4",100:"#dcfce7",200:"#bbf7d0",300:"#86efac",400:"#4ade80",500:"#22c55e",600:"#16a34a",700:"#15803d",800:"#166534",900:"#14532d",950:"#052e16"},emerald:{50:"#ecfdf5",100:"#d1fae5",200:"#a7f3d0",300:"#6ee7b7",400:"#34d399",500:"#10b981",600:"#059669",700:"#047857",800:"#065f46",900:"#064e3b",950:"#022c22"},teal:{50:"#f0fdfa",100:"#ccfbf1",200:"#99f6e4",300:"#5eead4",400:"#2dd4bf",500:"#14b8a6",600:"#0d9488",700:"#0f766e",800:"#115e59",900:"#134e4a",950:"#042f2e"},cyan:{50:"#ecfeff",100:"#cffafe",200:"#a5f3fc",300:"#67e8f9",400:"#22d3ee",500:"#06b6d4",600:"#0891b2",700:"#0e7490",800:"#155e75",900:"#164e63",950:"#083344"},sky:{50:"#f0f9ff",100:"#e0f2fe",200:"#bae6fd",300:"#7dd3fc",400:"#38bdf8",500:"#0ea5e9",600:"#0284c7",700:"#0369a1",800:"#075985",900:"#0c4a6e",950:"#082f49"},blue:{50:"#eff6ff",100:"#dbeafe",200:"#bfdbfe",300:"#93c5fd",400:"#60a5fa",500:"#3b82f6",600:"#2563eb",700:"#1d4ed8",800:"#1e40af",900:"#1e3a8a",950:"#172554"},indigo:{50:"#eef2ff",100:"#e0e7ff",200:"#c7d2fe",300:"#a5b4fc",400:"#818cf8",500:"#6366f1",600:"#4f46e5",700:"#4338ca",800:"#3730a3",900:"#312e81",950:"#1e1b4b"},violet:{50:"#f5f3ff",100:"#ede9fe",200:"#ddd6fe",300:"#c4b5fd",400:"#a78bfa",500:"#8b5cf6",600:"#7c3aed",700:"#6d28d9",800:"#5b21b6",900:"#4c1d95",950:"#2e1065"},purple:{50:"#faf5ff",100:"#f3e8ff",200:"#e9d5ff",300:"#d8b4fe",400:"#c084fc",500:"#a855f7",600:"#9333ea",700:"#7e22ce",800:"#6b21a8",900:"#581c87",950:"#3b0764"},fuchsia:{50:"#fdf4ff",100:"#fae8ff",200:"#f5d0fe",300:"#f0abfc",400:"#e879f9",500:"#d946ef",600:"#c026d3",700:"#a21caf",800:"#86198f",900:"#701a75",950:"#4a044e"},pink:{50:"#fdf2f8",100:"#fce7f3",200:"#fbcfe8",300:"#f9a8d4",400:"#f472b6",500:"#ec4899",600:"#db2777",700:"#be185d",800:"#9d174d",900:"#831843",950:"#500724"},rose:{50:"#fff1f2",100:"#ffe4e6",200:"#fecdd3",300:"#fda4af",400:"#fb7185",500:"#f43f5e",600:"#e11d48",700:"#be123c",800:"#9f1239",900:"#881337",950:"#4c0519"},white:"#ffffff",black:"#000000"};Object.assign($,{color:Re,css(...r){if(r.length===1){const e=r.at(0);return e&&e.selector&&dt.insertRule(e),e}else return r.map(e=>e&&e.selector?dt.insertRule(e):e)}});Object.assign(W.prototype,{css(...r){return $.fluent(this,arguments,()=>this,()=>(r.forEach(e=>e?dt.insertRule(e,this):this),this))}});$.css({selector:"page",display:"block",pos:"relative",pX:"1rem",pT:"var(--nav-height)"});class Ce extends Dt{constructor(){super();l(this,"$icon",$("ion-icon"));l(this,"$label",$("span"));this.addStaticClass("icon"),this.build()}build(){super.content([this.$icon.hide(!0),this.$label])}content(t){return this.$label.content(t),this}icon(t){return this.$icon.name(t).hide(!1),this}link(t,s=!1){return this.on("click",()=>s?$.replace(t):$.open(t)),this}}class De extends p{constructor(){super("ion-icon")}name(e){return this.attribute("name",e),this}size(e){return this.attribute("size",e),this}disable(e){return this.attribute("disable",e),this}link(e,t=!1){return this.on("click",()=>t?$.replace(e):$.open(e)),this}}$.registerTagName("ion-icon",De);$.registerTagName("icon-button",Ce);$.registerTagName("a",ne);class He{constructor(e,t){l(this,"booru");Object.assign(this,t),this.booru=e}static async fetchUserFavorites(e,t,s,i=100,n){return(await e.fetch(`/favorites.json?${s}&${`search[user_id]=${t.id}`}&limit=${i}&page=${n}`)).map(a=>(t.favorites.add(a.post_id),a.post_id))}update(e){return Object.assign(this,e),this}}class Mt{constructor(e,t,s=!0){l(this,"name$",$.state("..."));l(this,"post_upload_count$",$.state(0));l(this,"level$",$.state(10));l(this,"level_string$",$.state("..."));l(this,"booru");l(this,"favorites",new Set);this.booru=e,Object.assign(this,t),s&&this.update$()}static async fetch(e,t){var n;let s;if(typeof t=="string"){const o=(await e.fetch(`/users.json?search[name]=${t}`)).at(0);if(!o)throw"User Not Found";return s=o}else s=await e.fetch(`/users/${t}.json`);const i=((n=e.users.get(s.id))==null?void 0:n.update(s))??new this(e,s);return e.users.set(i.id,i),i}static async fetchMultiple(e,t,s=200){let i="";if(t)for(const[a,c]of Object.entries(t))if(c instanceof Array)i+=`&search[${a}]=${c}`;else if(c instanceof Object)for(const[h,f]of Object.entries(c))i+=`&search[${a}${h}]=${f}`;else i+=`&search[${a}]=${c}`;return(await e.fetch(`/users.json?limit=${s}${i}`)).map(a=>{const c=new this(e,a);return e.users.set(c.id,c),c})}update(e){return Object.assign(this,e),this.update$(),this}update$(){this.name$.set(this.name),this.post_upload_count$.set(this.post_upload_count),this.level$.set(this.level),this.level_string$.set(this.level_string)}get booruURL(){return`${this.booru.origin}/users/${this.id}`}get url(){return`/users/${this.id}`}}const St=class St extends Mt{constructor(t,s,i){super(t,i,!1);l(this,"apiKey");l(this,"favorite_count$",$.state(0));l(this,"forum_post_count$",$.state(0));this.apiKey=s,this.update$()}update$(){var t,s;super.update$(),(t=this.forum_post_count$)==null||t.set(this.forum_post_count),(s=this.favorite_count$)==null||s.set(this.favorite_count)}async init(){await this.fetchFavorites()}async fetchFavorites(){const t=Array.from(this.favorites.keys()).at(-1),s=await He.fetchUserFavorites(this.booru,this,"",1e3,t?`b${t}`:1);return St.events.fire("favoriteUpdate",this),s.length>=1e3&&this.fetchFavorites(),s}static get storageUserData(){const t=localStorage.getItem("user_data");return t?JSON.parse(t):null}static set storageUserData(t){localStorage.setItem("user_data",JSON.stringify(t))}};l(St,"events",new H);let z=St;const F=class F{constructor(e){l(this,"user");l(this,"posts",new Map);l(this,"tags",new Map);l(this,"users",new Map);l(this,"favorites",new Map);Object.assign(this,e),this.origin.endsWith("/")&&(this.origin=this.origin.slice(0,-1)),F.manager.set(this.name,this)}static set(e){this.used=e,this.name$.set(e.name),this.storageAPI=e.name;const t=z.storageUserData;return t&&e.login(t.username,t.apiKey),this.events.fire("set"),this}static get storageAPI(){return localStorage.getItem("booru_api")}static set storageAPI(e){e?localStorage.setItem("booru_api",e):localStorage.removeItem("booru_api")}async fetch(e,t="GET"){const s=this.user?`${e.includes("?")?"&":"?"}login=${this.user.name}&api_key=${this.user.apiKey}`:"",i=await fetch(`${this.origin}${e}${s}`,{method:t}).then(n=>n.json());if(i.success===!1)throw i.message;return i}async login(e,t){const s=await this.fetch(`/profile.json?login=${e}&api_key=${t}`);return this.user=new z(this,t,s),this.user.init(),F.events.fire("login",this.user),this.user}logout(){return this.user=void 0,z.storageUserData=null,F.events.fire("logout"),this}};l(F,"used"),l(F,"events",new H),l(F,"name$",$.state(F.name)),l(F,"manager",new Map);let y=F;const[Lt,Ne]=[new y({origin:"https://danbooru.donmai.us",name:"Danbooru"}),new y({origin:"https://safebooru.donmai.us",name:"Safebooru"}),new y({origin:"https://testbooru.donmai.us",name:"Testbooru"})];y.set(y.manager.get(y.storageAPI??"")??Lt);class Ut{constructor(e,t){l(this,"post_count$",$.state(0));l(this,"name$",$.state(""));l(this,"booru");this.booru=e,Object.assign(this,t),this.$update()}static async fetch(e,t){var n;const s=await e.fetch(`/tags/${t}.json`),i=((n=e.tags.get(s.id))==null?void 0:n.update(s))??new this(e,s);return e.tags.set(i.id,i),i}static async fetchMultiple(e,t,s=1e3){let i="";if(t)for(const[a,c]of Object.entries(t))if(c instanceof Array)i+=`&search[${a}]=${c}`;else if(c instanceof Object)for(const[h,f]of Object.entries(c))i+=`&search[${a}${h}]=${f}`;else i+=`&search[${a}]=${c}`;return(await e.fetch(`/tags.json?limit=${s}${i}`)).map(a=>{var h;const c=((h=e.tags.get(a.id))==null?void 0:h.update(a))??new this(e,a);return e.tags.set(c.id,c),c})}static get(e,t){return[...e.tags.values()].find(s=>s.name===t)}update(e){return Object.assign(this,e),this.$update(),this}$update(){this.post_count$.set(this.post_count),this.name$.set(this.name)}}var J=(r=>(r[r.General=0]="General",r[r.Artist=1]="Artist",r[r.Copyright=3]="Copyright",r[r.Character=4]="Character",r[r.Meta=5]="Meta",r))(J||{});const Ht=1e3,bt=Ht*60,wt=bt*60,_t=wt*24,je=_t*7,vt=new Intl.RelativeTimeFormat("en",{style:"long"});function At(r){r=Math.floor(r);const e=r/Ht,t=r/bt,s=r/wt,i=r/_t,n=r%1e3,o=Math.floor(r%6e4/1e3),a=Math.floor(r%36e5/6e4),c=Math.floor(r%(36e5*24)/36e5),h=o.toString().padStart(2,"0"),f=a.toString().padStart(2,"0"),u=c.toString().padStart(2,"0");return{seconds:e,minutes:t,hours:s,days:i,mil:n,s:o,min:a,h:c,ss:h,mm:f,hh:u}}function Fe(r,e=Date.now()){const t=r-e,s=Math.abs(t);if(s<bt)return vt.format(Math.round(t/Ht),"second");if(s<wt)return vt.format(Math.round(t/bt),"minute");if(s<_t)return vt.format(Math.round(t/wt),"hour");if(s<je)return vt.format(Math.round(t/_t),"day");const i=new Date(r);return`${i.getFullYear()}-${(i.getMonth()+1).toString().padStart(2,"0")}-${i.getDate().toString().padStart(2,"0")}`}function Ve(r){if(r<1e3)return`${r}B`;const e=r/1e3;if(e<1e3)return`${e.toFixed(2)}kB`;const t=r/1e3**2;if(t<1e3)return`${t.toFixed(2)}MB`;const s=r/1e3**3;if(s<1e3)return`${s.toFixed(2)}GB`;const i=r/1e3**4;if(i<1e3)return`${i.toFixed(2)}TB`;const n=r/1e3**5;return n<1e3?`${n.toFixed(2)}PB`:`${(r/(1e3*6)).toFixed(2)}EB`}const ze=new Intl.NumberFormat("en",{notation:"compact"});function ct(r){return ze.format(r)}const j="...";class tt extends H{constructor(t,s,i){super();l(this,"uploader$",S.state(j));l(this,"approver$",S.state(j));l(this,"created_date$",S.state(j));l(this,"favcount$",S.state(0));l(this,"score$",S.state(0));l(this,"file_size$",S.state(j));l(this,"file_ext$",S.state(j));l(this,"file_url$",S.state(j));l(this,"source$",S.state(j));l(this,"dimension$",S.state(j));l(this,"booruUrl$",S.state(j));l(this,"createdDate",new Date(this.created_at));l(this,"ready");l(this,"webm_url$",S.state(j));l(this,"booru");this.booru=t,this.id=s,t.posts.set(this.id,this),i?this.update(i):this.ready=this.fetch()}static get(t,s){return t.posts.get(s)??new tt(t,s)}async fetch(){const t=await this.booru.fetch(`/posts/${this.id}.json`);return this.update(t),Mt.fetchMultiple(this.booru,{id:[this.uploader_id,this.approver_id].detype(null)}).then(()=>this.update$()),this}static async fetchMultiple(t,s,i=20,n){let o="";if(s){if(typeof s=="string")o=s;else for(const[u,d]of Object.entries(s))if(d!==void 0){if(u==="tags"){o+=`${d}`;continue}o.at(-1)!=="="&&(o+=" "),o+=`${u}:${d}`}}const a=await t.fetch(`/posts.json?limit=${i}&tags=${o}${n?`&page=${n}`:""}&_method=get`);if(!(a instanceof Array))return[];const c=new Set,h=a.map(u=>{var m;const d=((m=t.posts.get(u.id))==null?void 0:m.update(u))??new this(t,u.id,u);return t.posts.set(d.id,d),d.tag_string.split(" ").forEach(b=>c.add(b)),d});if(!h.length)return h;const f=[...new Set(a.map(u=>[u.approver_id,u.uploader_id].detype(null)).flat())];return Mt.fetchMultiple(t,{id:f}).then(()=>h.forEach(u=>u.update$())),h}update$(){var t,s,i,n;this.uploader$.set(((t=this.uploader)==null?void 0:t.name$)??((s=this.uploader_id)==null?void 0:s.toString())),this.approver$.set(((i=this.approver)==null?void 0:i.name$)??((n=this.approver_id)==null?void 0:n.toString())??"None"),this.created_date$.set(Fe(+new Date(this.created_at))),this.favcount$.set(this.fav_count),this.score$.set(this.score),this.file_size$.set(Ve(this.file_size)),this.file_ext$.set(this.file_ext),this.file_url$.set(this.file_url),this.source$.set(this.source),this.dimension$.set(`${this.image_width}x${this.image_height}`),this.booruUrl$.set(`${this.booruUrl}`),this.isUgoria&&this.webm_url$.set(this.large_file_url),this.createdDate=new Date(this.created_at),this.fire("update")}update(t){return Object.assign(this,t),this.update$(),this}async fetchTags(){await this.ready;const t=this.tag_string.split(" ").filter(s=>!Ut.get(this.booru,s));return t.length?(await Ut.fetchMultiple(this.booru,{name:{_space:t.toString().replaceAll(","," ")}}),this):this}async createFavorite(){if(!this.booru.user)return;const t=await this.booru.fetch(`/favorites.json?post_id=${this.id}`,"POST");return this.update(t),this.booru.user.favorites.add(t.id),this.booru.user.favorite_count+=1,this.booru.user.update$(),z.events.fire("favoriteUpdate",this.booru.user),t.id}async deleteFavorite(){!this.booru.user||await fetch(`/api/favorites/${this.id}?login=${this.booru.user.name}&api_key=${this.booru.user.apiKey}&origin=${this.booru.origin}`,{method:"DELETE"}).then(s=>s.json())===!1||(this.fav_count--,this.favcount$.set(this.fav_count),this.booru.user.favorites.delete(this.id),this.booru.user.favorite_count-=1,this.booru.user.update$(),z.events.fire("favoriteUpdate",this.booru.user))}get pathname(){return`/posts/${this.id}`}get uploader(){return this.booru.users.get(this.uploader_id)}get approver(){return this.approver_id?this.booru.users.get(this.approver_id):null}get isVideo(){return this.file_ext==="mp4"||this.file_ext==="webm"||this.file_ext==="zip"}get isGif(){return this.file_ext==="gif"}get isUgoria(){return this.file_ext==="zip"}get hasSound(){return this.tag_string_meta.includes("sound")}get tags(){const t=this.tag_string.split(" ");return[...this.booru.tags.values()].filter(s=>t.includes(s.name))}get previewURL(){var t,s,i;return((i=(s=(t=this.media_asset)==null?void 0:t.variants)==null?void 0:s.find(n=>n.file_ext==="webp"))==null?void 0:i.url)??this.large_file_url}get booruUrl(){return`${this.booru.origin}/posts/${this.id}`}get url(){return`https://danbooru.defaultkavy.com/posts/${this.id}`}get isFileSource(){return this.source.startsWith("file://")}get isLargeFile(){return this.file_size>5e6}}class oe{constructor(e){Object.assign(this,e)}static async fetch(e,t){const s=await e.fetch(`/artist_commentaries/${t}.json`);return new this(s)}static async fetchMultiple(e,t,s=200){let i="";if(t)for(const[a,c]of Object.entries(t))if(c instanceof Array)i+=`&search[${a}]=${c}`;else if(c instanceof Object)for(const[h,f]of Object.entries(c))i+=`&search[${a}${h}]=${f}`;else i+=`&search[${a}]=${c}`;return(await e.fetch(`/artist_commentaries.json?limit=${s}${i}`)).map(a=>{const c=new this(a);return this.manager.set(c.id,c),c})}}l(oe,"manager",new Map);class ae extends p{constructor(t){super("detail-panel");l(this,"post",null);l(this,"options");this.options={preview:(t==null?void 0:t.preview)??!1,tagsType:(t==null?void 0:t.tagsType)??"detail"},this.build()}build(){this.post?this.content([this.options.preview?$("div").class("preview").content([$("img").src(this.post.previewURL)]):null,$("div").class("detail").content([$("section").class("post-info").content([new L("id").name("Post").content(`#${this.post.id}`),new L("uploader").name("Uploader").content(this.post.uploader$),new L("approver").name("Approver").content(this.post.approver$),new L("date").name("Date").content(this.post.created_date$),new L("size").name("Size").content([this.post.file_size$,this.post.dimension$]),new L("file-type").name("File Type").content(this.post.file_ext$),$("div").class("inline").content([new L("favorites").name("Favorites").content(this.post.favcount$),new L("score").name("Score").content(this.post.score$)]),this.post.file_url?new L("file-url").name("File").content([$("a").href(this.post.file_url$).content(this.post.file_url$.convert(t=>t?t.replace("https://",""):"")).target("_blank"),$("ion-icon").name("clipboard").on("click",(t,s)=>this.copyButtonHandler(s,this.post.file_url))]):null,new L("source-url").name("Source").content([$("a").href(this.post.source$).content(this.post.source$.convert(t=>t.replace("https://",""))).target("_blank"),$("ion-icon").name("clipboard").on("click",(t,s)=>this.copyButtonHandler(s,this.post.source))]),new L("booru-url").name(y.name$).content([$("a").href(this.post.booruUrl$).content(this.post.booruUrl$.convert(t=>t.replace("https://",""))).target("_blank"),$("ion-icon").name("clipboard").on("click",(t,s)=>this.copyButtonHandler(s,this.post.booruUrl))]),new L("webm-url").name("Webm").hide(!0).self(async t=>{await this.post.ready,this.post.isUgoria&&t.content($("a").href(this.post.webm_url$).content(this.post.webm_url$.convert(s=>s.replace("https://",""))).target("_blank")).hide(!1)})]),$("div").class("post-tags").content(async t=>{if(this.options.tagsType==="detail"){let s=function(f,u){return u.length?[$("h3").content(f),$("section").content([u.map(d=>$("div").class("tag").content([$("a").class("tag-name").content(d.name).href(`/posts?tags=${d.name}`),$("span").class("tag-post-count").content(d.post_count$.convert(ct))]))])]:null};const i=(await this.post.fetchTags()).tags,[n,o,a,c,h]=[i.filter(f=>f.category===J.Artist),i.filter(f=>f.category===J.Character),i.filter(f=>f.category===J.General),i.filter(f=>f.category===J.Meta),i.filter(f=>f.category===J.Copyright)];return[s("Artist",n),s("Character",o),s("Copyright",h),s("Meta",c),s("General",a)]}else{let s=function(i,n){var o;return(o=n.at(0))!=null&&o.length?[$("h3").content(i),$("section").class("tag-name-only").content([n.map(a=>$("a").class("tag").content(a).href(`/posts?tags=${a}`))])]:null};return[s("Artist",this.post.tag_string_artist.split(" ")),s("Character",this.post.tag_string_character.split(" ")),s("Copyright",this.post.tag_string_copyright.split(" ")),s("Meta",this.post.tag_string_meta.split(" ")),s("General",this.post.tag_string_general.split(" "))]}})])]):this.content($("span").class("no-content").content("No Selected"))}update(t){return this.post=t,this.build(),this}copyButtonHandler(t,s){t.name("checkmark"),navigator.clipboard.writeText(s),setTimeout(()=>t.name("clipboard"),3e3)}position(t){let s=0;return addEventListener("scroll",()=>{this.inDOM()&&(s=document.documentElement.scrollTop)},{passive:!0}),t.on("beforeShift",()=>{innerWidth>800&&this.style({position:"absolute",top:`calc(${s}px + var(--nav-height) + var(--padding))`})}).on("afterShift",()=>this.style({position:"",top:""})),this}}class L extends p{constructor(t){super("div");l(this,"$name",$("span").class("property-name"));l(this,"$values",$("div").class("property-values"));this.staticClass("property").attribute("property-id",t),super.content([this.$name,this.$values.hide(!0)])}name(t){return this.$name.content(t),this}content(t){this.$values.hide(!1);const s=$.orArrayResolve(t);return this.$values.content(s.map(i=>$("span").staticClass("property-value").content(i))),this}}const ht=class ht{constructor(e){l(this,"orderMap",new Map);l(this,"cache",new Set);l(this,"limit",100);l(this,"tags");l(this,"finished",!1);l(this,"events",new H);this.tags=e,ht.managers.set(this.tags,this),y.events.on("set",()=>{this.clear(),this.finished&&(this.finished=!1)})}static get(e){const t=this.managers.get(e)??new ht(e);return this.managers.set(t.tags,t),t}clear(){this.orderMap.clear(),this.cache.clear()}addPosts(e){e=$.orArrayResolve(e);for(const t of e)t.file_url&&(this.cache.has(t)||this.cache.add(t));return this}async fetchPosts(e){const t=[],s=[];let i=this.limit,n=[];for(const o of this.tag_list)o.startsWith("ordfav:")||o.startsWith("order:")?s.push(o):o.startsWith("limit:")?i=Number(o.split(":")[1]):t.push(o);if(s.length){if(s.length>1)return this.events.fire("post_error",`Error: These query can't be used together [${s}].`),[];const o=s[0];if(o.startsWith("ordfav:")){const a=o.split(":")[1],c=t.length?`&search[post_tags_match]=${t.toString().replaceAll(",","+")}`:"",h=this.orderKeyList.length?e==="newer"?`&search[id]=>${this.orderKeyList.at(0)}`:`&search[id]=<${this.orderKeyList.at(-1)}`:void 0,f=await y.used.fetch(`/favorites.json?search[user_name]=${a}${h??""}${c}&limit=${i}`);n=await tt.fetchMultiple(y.used,{tags:`id:${f.map(d=>d.post_id).toString()}`},i);const u=new Map;for(const d of f){const m=n.find(b=>b.id===d.post_id);m&&m.file_url&&u.set(d.id,m)}this.orderMap=new Map(e==="newer"?[...u,...this.orderMap]:[...this.orderMap,...u]),this.events.fire("post_fetch",{manager:this,postList:n})}if(o.startsWith("order:")){const a=this.orderKeyList.length?e==="newer"?1:this.orderMap.size/i+1:void 0;n=await tt.fetchMultiple(y.used,{tags:this.tags},i,a);const c=new Map(n.filter(h=>h.file_url).map(h=>[h.id,h]));c.forEach((h,f)=>{this.orderMap.has(f)&&c.delete(f)}),this.orderMap=new Map(e==="newer"?[...c,...this.orderMap]:[...this.orderMap,...c]),this.events.fire("post_fetch",{manager:this,postList:n})}}else{const o=this.orderKeyList.length?e==="newer"?`a${this.orderKeyList.at(0)}`:`b${this.orderKeyList.at(-1)}`:void 0;n=await tt.fetchMultiple(y.used,{tags:this.tags},i,o);const a=new Map(n.filter(c=>c.file_url).map(c=>[c.id,c]));this.orderMap=new Map(e==="newer"?[...a,...this.orderMap]:[...this.orderMap,...a])}return!n.length&&e==="older"&&(this.finished=!0,this.cache.size?this.events.fire("endPost"):this.events.fire("noPost")),this.events.fire("post_fetch",{manager:this,postList:n}),this.addPosts(n),n}get orderKeyList(){return[...this.orderMap.keys()]}get tag_list(){return this.tags?decodeURIComponent(this.tags).split("+"):[]}};l(ht,"managers",new Map);let xt=ht;class We extends p{constructor(t,s,i){super("video-controller");l(this,"$video");l(this,"$viewer");l(this,"duration$",$.state("00:00"));l(this,"post");this.$video=t,this.$viewer=s,this.post=i,this.build()}build(){const t=$.events();this.$video.on("timeupdate",()=>this.durationUpdate()),this.content([$("div").class("video-details").content([$("div").class("left").content([$("ion-icon").class("play").title("Play").name("play").self(s=>{this.$video.on("play",()=>s.name("pause")).on("pause",()=>s.name("play")),s.on("click",()=>this.$video.isPlaying?this.$video.pause():this.$video.play())}),$("div").class("duration").content([$("span").class("current-time").content(this.duration$),$("span").content("/"),$("span").class("total-time").content("00:00").self(s=>{this.$video.on("loadeddata",()=>{const i=At(this.$video.duration*1e3);s.content(Number(i.hh)>0?`${i.hh}:${i.mm}:${i.ss}`:`${i.mm}:${i.ss}`)})})])]),$("div").class("right").content([$("ion-icon").class("volume").title("Volume").name("volume-high").disable(!this.post.hasSound).self(s=>{const i=()=>{this.$video.muted()?s.name("volume-mute"):s.name("volume-high")};s.on("click",()=>{this.$video.muted(!this.$video.muted()),i()})}),$("ion-icon").class("full-screen").title("Full-Screen").name("scan").self(s=>{s.on("click",()=>{document.fullscreenElement?document.exitFullscreen():this.$viewer.dom.requestFullscreen()})})])]),$("div").class("progressbar-container").content([$("div").class("progressbar").content([$("div").class("progress").self(s=>{this.$video.on("timeupdate",i=>{s.style({width:`${this.$video.currentTime()/this.$video.duration*100}%`})}),t.on("progressChange",i=>{s.style({width:`${i*100}%`})})})])]).self(s=>{const i=$.pointers($(document.body));let n=!1;i.on("down",(o,a)=>{if(!s.contains(o.$target))return o.delete();a.preventDefault(),this.$video.isPlaying&&(n=!0,this.$video.pause());const c=(o.x-s.domRect().x)/s.offsetWidth;this.$video.currentTime(c*this.$video.duration)}),i.on("move",(o,a)=>{a.preventDefault();const c=(o.x-s.domRect().x)/s.offsetWidth;this.$video.currentTime(c*this.$video.duration),t.fire("progressChange",c)}),i.on("up",(o,a)=>{n&&this.$video.play(),n=!1})})])}durationUpdate(){const t=At(this.$video.currentTime()*1e3);this.duration$.set(Number(t.hh)>0?`${t.hh}:${t.mm}:${t.ss}`:`${t.mm}:${t.ss}`)}}class Ue extends p{constructor(t){super("div");l(this,"$video",$("video"));l(this,"post");this.post=t,this.class("viewer"),this.build()}async build(){await this.post.ready,this.events.on("video_play_pause",()=>{this.$video.isPlaying?this.$video.pause():this.$video.play()}),this.content([$("div").class("viewer-panel").hide(!1).content(s=>(this.events.on("viewerPanel_hide",()=>s.hide(!0)).on("viewerPanel_show",()=>s.hide(!1)).on("viewerPanel_switch",()=>{s.hide(!s.hide())}),[$("div").class("panel").content([this.post.isVideo?new We(this.$video,this,this.post):null,$("div").class("buttons").content([$("ion-icon").title("Favorite").name("heart-outline").self(i=>{var n;y.used.user?i.hide(!1):i.hide(!0),y.events.on("login",()=>i.hide(!1)),z.events.on("favoriteUpdate",o=>{o.favorites.has(this.post.id)?i.name("heart"):i.name("heart-outline")}),(n=y.used.user)!=null&&n.favorites.has(this.post.id)&&i.name("heart"),i.on("click",()=>{var o;(o=y.used.user)!=null&&o.favorites.has(this.post.id)?this.post.deleteFavorite():this.post.createFavorite()})}),$("ion-icon").title("Original Size").name("resize-outline").self(i=>{i.on("click",()=>{this.events.fire("original_size"),i.disable(!0)}),(!this.post.isLargeFile||this.post.isVideo)&&i.disable(!0)})])]),$("div").class("overlay")])),this.post.isVideo?this.$video.height(this.post.image_height).width(this.post.image_width).src(this.post.file_ext==="zip"?this.post.large_file_url:this.post.file_url).controls(!1).loop(!0).disablePictureInPicture(!0):$("img").height(this.post.image_height).width(this.post.image_width).self(s=>{s.once("load",()=>s.once("load",()=>s.removeClass("loading")).src(this.post.isLargeFile?this.post.large_file_url:this.post.file_url)).src(this.post.preview_file_url),s.complete||s.class("loading"),this.events.on("original_size",()=>s.src(this.post.file_url))})]),this.on("pointerleave",s=>{s.pointerType!=="touch"&&this.events.fire("viewerPanel_hide")}),this.on("pointermove",s=>{(s.pointerType==="mouse"||s.pointerType==="pen")&&this.events.fire("viewerPanel_show")});let t=null;$.pointers(this).on("up",s=>{var i;(i=this.$(":.viewer-panel .panel"))!=null&&i.contains($(s.$target))||(s.type==="mouse"?this.events.fire("video_play_pause"):(t!==null&&this.events.fire("video_play_pause"),t=setTimeout(()=>{t=null},300),this.events.fire("viewerPanel_switch")))}),$.keys($(window)).self(s=>s.if(i=>{if(!($(i.target)instanceof M)&&this.inDOM())return!0}).keydown(" ",i=>{i.preventDefault(),this.$video.isPlaying?this.$video.pause():this.$video.play()}))}}var st;class Be extends p{constructor(){super("slide-viewer");l(this,"pointers",new ee(this));l(this,"$container",$("div").class("slide-container"));l(this,"slideMap",new Map);l(this,"slideId",null);U(this,st);this.style({position:"relative"}),this.__build__(),new ResizeObserver(()=>{this.inDOM()&&(this.__render__(),this.trigger("resize"))}).observe(this.dom)}__build__(){this.content([this.$container]),this.$container.style({position:"relative",height:"100%"});let t=0,s=0;this.pointers.on("down",(i,n)=>{if(I(this,st)&&!I(this,st).call(this,i,n))return i.delete();t=this.$container.offsetLeft}),this.pointers.on("move",(i,n)=>{var o,a;i.direction===se.Horizontal&&(n.preventDefault(),s=t+i.move_x,!(s>t&&((o=this.slideList.at(0))==null?void 0:o.slideId())===this.slideId)&&(s<t&&((a=this.slideList.at(-1))==null?void 0:a.slideId())===this.slideId||this.$container.style({left:`${s}px`})))}),this.pointers.on("up",i=>{const n=this.domRect().width,o=t-this.$container.offsetLeft;i.move_x!==0&&(i.move_x<0&&i.movement_x<-2||o>n/2?this.next():i.move_x>0&&i.movement_x>2||o+n<n/2?this.prev():(s=t,this.__slideAnimate__()))})}addSlides(t){if(t=$.orArrayResolve(t),!!t.length){for(const s of t)s instanceof Array?this.addSlides(s):(this.slideMap.set(s.slideId(),s),this.$container.insert(s));return this.__render__(),this}}arrange(t){const s=new Map;return t.forEach(i=>{const n=this.slideMap.get(i);n&&s.set(i,n)}),this.slideMap=s,this.__render__(),this}switch(t){if(t===void 0)return this;const s=this.slideMap.get(t);if(!s)throw"target undefined";return s.slideId()===this.slideId?this:(this.events.fire("beforeSwitch",{prevSlide:this.currentSlide,nextSlide:s}),this.slideId=t,this.__slideAnimate__(),this.events.fire("switch",{nextSlide:s}),this)}__slideAnimate__(){const t=this.currentSlide?this.slideList.indexOf(this.currentSlide):void 0;if(t===void 0)return;const s=Math.abs(this.getPositionLeft(t)-this.$container.offsetLeft)===this.dom.clientWidth;this.$container.animate({left:`-${this.getPositionLeft(t)}px`},{duration:300,easing:s?"ease":"ease-out"},i=>{this.$container.style({left:`-${this.getPositionLeft(t)}px`}),this.__render__(!1)})}__navigation__(t){var c;const s=this.currentSlide,i=this.slideList,n=s?i.indexOf(s):void 0;if(n===void 0)return this.switch((c=i.at(0))==null?void 0:c.slideId()),this;const o=$.call(()=>{switch(t){case"next":return n===i.length?n:n+1;case"prev":return n===0?n:n-1}}),a=this.slideList.at(o);return this.switch(a==null?void 0:a.slideId()),this}next(){return this.__navigation__("next")}prev(){return this.__navigation__("prev")}get currentSlide(){return this.slideId?this.slideMap.get(this.slideId):void 0}get slideIdList(){return Array.from(this.slideMap.keys())}get slideList(){return Array.from(this.slideMap.values())}getPositionLeft(t){return t*this.dom.clientWidth}__render__(t=!0){var n,o;let s=0;if(this.slideMap.forEach(a=>{a.hide(!0,!1),a.style({top:"0",left:`${this.getPositionLeft(s)}px`}),s++}),!this.currentSlide)return;const i=this.slideList.indexOf(this.currentSlide);this.currentSlide.build().hide(!1,!1),i!==0&&((n=this.slideList.at(i-1))==null||n.build().hide(!1,!1)),i!==this.slideList.length-1&&((o=this.slideList.at(i+1))==null||o.build().hide(!1,!1)),this.$container.children.render(),t&&this.$container.style({left:`-${this.getPositionLeft(i)}px`})}pointerException(t){return B(this,st,t),this}}st=new WeakMap;var it,gt;class Xe extends p{constructor(){super("slide");U(this,it);l(this,"builded",!1);U(this,gt);this.style({width:"100%",height:"100%",display:"block",position:"absolute"})}builder(t){return B(this,it,t),this}build(){return!this.builded&&I(this,it)&&(this.content(I(this,it).call(this)),this.builded=!0),this}slideId(t){return $.fluent(this,arguments,()=>I(this,gt),()=>B(this,gt,t))}}it=new WeakMap,gt=new WeakMap;const X=class X{static get previewPanelEnabled(){var e;return(e=this.localdata)==null?void 0:e.previewPanelEnabled}static set previewPanelEnabled(e){this.localdata={...this.localdata,previewPanelEnabled:e}}static get detailPanelEnabled(){var e;return(e=this.localdata)==null?void 0:e.detailPanelEnabled}static set detailPanelEnabled(e){this.localdata={...this.localdata,detailPanelEnabled:e}}static get localdata(){const e=localStorage.getItem("local_settings_data");return e?JSON.parse(e):null}static set localdata(e){localStorage.setItem("local_settings_data",JSON.stringify(e))}};l(X,"previewPanelEnable$",$.state(X.previewPanelEnabled??!1).on("update",({state$:e})=>X.previewPanelEnabled=e.value)),l(X,"detailPanelEnable$",$.state(X.detailPanelEnabled??!0).on("update",({state$:e})=>X.detailPanelEnabled=e.value));let T=X;const Ge=$("route").path("/posts/:id?q").static(!1).builder(({$page:r,params:e})=>{if(!Number(e.id))return r.content($("h1").content("404: POST NOT FOUND"));const t=$.events();let s,i;$.keys($(window)).self(h=>h.if(f=>{if(!($(f.target)instanceof M)&&r.inDOM())return!0}).keydown(["f","F"],f=>{var u;(u=y.used.user)!=null&&u.favorites.has(s.id)?s.deleteFavorite():s.createFavorite()}).keydown(["a","A"],f=>c("prev")).keydown(["d","D"],f=>{c("next")}));const n=new Map;r.on("open",async({params:h,query:f})=>{var d;if(i=xt.get(f.q),s=tt.get(y.used,+h.id),i.events.on("post_fetch",o),!i.orderMap.size||!i.cache.has(s)){await s.ready,i.addPosts(s);const m=(d=i.tag_list)==null?void 0:d.find(b=>b.startsWith("ordfav"));if(m){const b=m.split(":")[1],k=await y.used.fetch(`/favorites.json?search[user_name]=${b}&search[post_id]=${s.id}`);k[0]&&i.orderMap.set(k[0].id,s)}else i.orderMap.set(s.id,s);i.fetchPosts("newer"),i.fetchPosts("older")}else{const m=[...i.orderMap.values()],b=m.indexOf(s);!i.finished&&b===m.length-1?i.fetchPosts("older"):b===0&&i.fetchPosts("newer")}o({manager:i}),a(i.tags).switch(s.id),t.fire("post_switch",s)});function o(h){const{manager:f}=h,u=a(f.tags),d=f.cache.array.filter(m=>!u.slideMap.has(m.id));u.addSlides(d.map(m=>new Xe().slideId(m.id).builder(()=>new Ue(m)))),d.length&&u.arrange([...f.orderMap.values()].map(m=>m.id))}function a(h){const f=n.get(h)??new Be().pointerException(u=>{var d;return!((d=f.currentSlide)!=null&&d.$("::.progressbar-container").find(m=>m.contains(u.$target))||u.type==="mouse")}).on("switch",({nextSlide:u})=>{$.replace(`/posts/${u.slideId()}${h?`?q=${h}`:""}`)}).on("beforeSwitch",({prevSlide:u,nextSlide:d})=>{const m=u==null?void 0:u.$(":video");m!=null&&m.isPlaying&&m.pause();const b=d.$(":video");(b==null?void 0:b.isPlaying)===!1&&b.play()});return n.set(h,f),f}function c(h){const f=[...i.orderMap.values()],u=f.indexOf(s);if(h==="prev"&&u===0)return;const d=f.at(h==="next"?u+1:u-1);d&&$.replace(`/posts/${d.id}${i.tags?`?q=${i.tags}`:""}`)}return r.id("post").content([$("div").class("slide-viewer-container").self(h=>{r.on("open",()=>{h.content(a(i.tags))})}),$("div").class("content").content([$("h3").content("Artist's Commentary"),$("section").class("commentary").self(async h=>{t.on("post_switch",async f=>{const u=(await oe.fetchMultiple(y.used,{post:{_id:f.id}})).at(0);h.content([u?[u.original_title?$("h3").content(u.original_title):null,$("pre").content(u.original_description)]:"No commentary"])})})]),new ae().hide(T.detailPanelEnable$.convert(h=>!h)).position(r).self(h=>{t.on("post_switch",u=>h.update(u)),f(),T.detailPanelEnable$.on("update",({state$:u})=>f());function f(){T.detailPanelEnable$.value?r.removeStaticClass("side-panel-disable"):r.addStaticClass("side-panel-disable")}})])});class le{static async fetch(e,t,s=20){if(!t.length)return this.searchQuery.map(o=>new Bt(o));const i=await e.fetch(`/autocomplete.json?search[query]=${t}&search[type]=tag_query&version=1&limit=${s}`);return[...t.length?this.searchQuery.filter(o=>o.value.startsWith(t)&&o.value!==t):this.searchQuery,...i].map(o=>new Bt(o))}}l(le,"searchQuery",[{value:"user:",label:"user:"},{value:"approver:",label:"approver:"},{value:"-approver:",label:"-approver:"},{value:"order:",label:"order:"},{value:"ordfav:",label:"ordfav:"},{value:"ordfavgroup:",label:"ordfavgroup:"},{value:"search:",label:"search:"},{value:"favgroup:",label:"favgroup:"},{value:"-favgroup:",label:"-favgroup:"},{value:"favcount:",label:"favcount:"},{value:"id:",label:"id:"},{value:"tagcount:",label:"tagcount:"},{value:"gentags:",label:"gentags:"},{value:"arttags:",label:"arttags:"},{value:"chartags:",label:"chartags:"},{value:"copytags:",label:"copytags:"},{value:"metatags:",label:"metatags:"},{value:"score:",label:"score:"},{value:"upvote:",label:"upvote:"},{value:"downvote:",label:"downvote:"},{value:"disapproved:",label:"disapproved:"},{value:"md5:",label:"md5:"},{value:"width:",label:"width:"},{value:"height:",label:"height:"},{value:"ratio:",label:"ratio:"},{value:"mpixels:",label:"mpixels:"},{value:"filesize:",label:"filesize:"},{value:"duration:",label:"duration:"},{value:"is:",label:"is:"},{value:"has:",label:"has:"},{value:"pool:",label:"pool:"},{value:"-pool:",label:"-pool:"},{value:"ordpool:",label:"ordpool:"},{value:"random:",label:"random:"},{value:"limit:",label:"limit:"},{value:"date:",label:"date:"},{value:"commenter:",label:"commenter:"},{value:"note:",label:"note:"},{value:"noter:",label:"noter:"},{value:"noteupdater:",label:"noteupdater:"},{value:"status:",label:"status:"},{value:"-status:",label:"-status:"},{value:"rating:",label:"rating:"},{value:"-rating:",label:"-rating:"},{value:"source:",label:"source:"},{value:"-source:",label:"-source:"},{value:"pixiv:",label:"pixiv:"},{value:"parent:",label:"parent:"},{value:"child:",label:"child:"},{value:"flagger:",label:"flagger:"},{value:"appealer:",label:"appealer:"},{value:"commentary:",label:"commentary:"},{value:"commentaryupdater:",label:"commentaryupdater:"}].map(e=>({type:"query",...e})));class Bt{constructor(e){Object.assign(this,e)}isTag(){return this.type==="tag"||this.type==="tag-autocorrect"||this.type==="tag-alias"||this.type==="tag-word"}isTagAutocorrect(){return this.type==="tag-autocorrect"}isTagAntecedent(){return!!this.antecedent}isTagWord(){return this.type==="tag-word"}isUser(){return this.type==="user"}}class Ke extends p{constructor(t){super("tag");l(this,"name");this.name=t,this.build()}build(){this.content(this.name)}}class Ye extends p{constructor(t){super("tag-input");l(this,"$input",$("input").type("text"));l(this,"$sizer",$("span").class("sizer"));l(this,"$inputor",$("div").class("input-wrapper").content([this.$sizer,this.$input.on("input",()=>{this.$sizer.content(this.$input.value())})]));l(this,"tags",new Set);l(this,"$seachbar");this.$seachbar=t}input(){return this.insert(this.$inputor),this.$input.focus(),this.$seachbar.$selectionList.clearSelections(),this.$seachbar.getSearchSuggestions(),this}addTag(t){if(t=t??this.$input.value(),!t.length)return this;const s=new Ke(t);return s.on("click",()=>this.editTag(s)),this.tags.add(s),this.value(""),this.$input.inDOM()?this.$inputor.replace(s):this.insert(s),this}editTag(t){return this.addTag(),this.tags.delete(t),t.replace(this.$inputor),this.value(t.name),this.$input.focus(),this.$seachbar.getSearchSuggestions(),this}clearAll(){return this.value(""),this.tags.clear(),this.clear(),this}value(t){return t===void 0?this:(this.$input.value(t),this.$sizer.content(t),this)}focus(){return this.$input.focus(),this}get query(){return this.tags.array.map(t=>t.name).toString().toLowerCase().replace(",","+")}}class qe extends p{constructor(){super("selection-list");l(this,"focused",null);l(this,"selections",new Set)}addSelections(t){t=$.orArrayResolve(t);for(const s of t)this.selections.add(s);return this.insert(t),this}clearSelections(){return this.focused=null,this.selections.clear(),this.clear(),this}focusSelection(t){return this.blurSelection(),this.focused=t,t.focus(),t.offsetTop<this.scrollTop()&&this.scrollTop(t.offsetTop),t.offsetTop+t.offsetHeight>this.scrollTop()+this.offsetHeight&&this.scrollTop(t.offsetTop+t.offsetHeight-this.offsetHeight),this}blurSelection(){var t;return(t=this.focused)==null||t.blur(),this.focused=null,this}focusNextSelection(){const t=this.selections.array,s=t.at(0);if(this.focused){const i=t.at(t.indexOf(this.focused)+1);i?this.focusSelection(i):s&&this.focusSelection(s)}else s&&this.focusSelection(s)}focusPrevSelection(){const t=this.selections.array;if(this.focused){const s=t.at(t.indexOf(this.focused)-1);s&&this.focusSelection(s)}else{const s=t.at(0);s&&this.focusSelection(s)}}}class Je extends p{constructor(){super("selection");l(this,"property",{value:""})}value(t){return $.fluent(this,arguments,()=>this.property.value,()=>$.set(this.property,"value",t))}focus(){return this.addClass("active"),this}blur(){return this.removeClass("active"),this}}const Tt=class Tt extends p{constructor(){super("searchbar");l(this,"$tagInput",new Ye(this));l(this,"$selectionList",new qe);l(this,"typingTimer",null);l(this,"$filter",$("div").class("filter"));this.build(),$.keys($(window)).keydown("/",t=>{t.preventDefault(),this.open()}).keyup("Escape",t=>{this.inDOM()&&t.preventDefault(),this.close()})}build(){this.content([$("div").class("input-container").content([this.$tagInput.on("input",()=>this.inputHandler()).on("keydown",t=>this.keyHandler(t)),$("ion-icon").name("close-circle-outline").title("Clear Input").on("click",()=>this.$tagInput.clearAll())]).on("click",t=>{t.target===this.$tagInput.dom&&this.$tagInput.addTag().input()}),$("div").class("selection-list-container").content([this.$selectionList]),this.$filter.on("click",()=>{location.hash==="#search"&&this.close()})])}open(){return location.hash!=="#search"&&$.open(location.href+"#search"),this}close(){return location.hash==="#search"&&$.back(),this}activate(){return this.hide(!1),this.$filter.animate({opacity:[0,.5]},{duration:300,easing:"ease"}),this.$tagInput.input(),this}inactivate(){return this.animate({opacity:[.5,0]},{duration:300,easing:"ease"},()=>this.hide(!0)),this}keyHandler(t){var n,o;const s=()=>{t.preventDefault(),this.$tagInput.addTag().input()},i=a=>{const c=this.$tagInput.children.indexOf(this.$tagInput.$inputor);if(this.$tagInput.$input.value().at(-1)===":")return this.getSearchSuggestions();const h=this.$tagInput.children.array.at(c+1);this.$tagInput.addTag(a.value()),h?this.$tagInput.editTag(h):this.$tagInput.input()};switch(t.key){case"ArrowUp":{t.preventDefault(),this.$selectionList.focusPrevSelection(),this.$tagInput.value((n=this.$selectionList.focused)==null?void 0:n.value());break}case"ArrowDown":{t.preventDefault(),this.$selectionList.focusNextSelection(),this.$tagInput.value((o=this.$selectionList.focused)==null?void 0:o.value());break}case" ":s();break;case"Enter":{t.preventDefault(),this.$selectionList.focused?i(this.$selectionList.focused):(this.$tagInput.addTag(),this.search());break}case"Tab":{t.preventDefault();const a=this.$tagInput.children.indexOf(this.$tagInput.$inputor);if(t.shiftKey){a-1>=0&&this.$tagInput.editTag(this.$tagInput.children.array.at(a-1));break}if(this.$selectionList.focused)i(this.$selectionList.focused);else{const c=this.$tagInput.children.array.at(a+1);c?this.$tagInput.editTag(c):this.$tagInput.addTag().input()}break}case"Backspace":{const a=this.$tagInput.children.indexOf(this.$tagInput.$inputor);a!==0&&!this.$tagInput.$input.value().length&&(t.preventDefault(),this.$tagInput.editTag(this.$tagInput.children.array.at(a-1)));break}}}inputHandler(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=null),this.typingTimer=setTimeout(async()=>{this.typingTimer=null,this.getSearchSuggestions()},200)}async getSearchSuggestions(){const t=this.$tagInput.$input.value(),s=await le.fetch(y.used,t,20);this.$selectionList.clearSelections().addSelections(s.map(i=>new Je().value(i.value).content([$("div").class("selection-label").content([i.isTagAntecedent()?$("span").class("tag-antecedent").self(n=>n.dom.innerHTML=i.antecedent.replaceAll(t,`<b>${t}</b>`)):null,$("div").class("label-container").content([i.isTagAntecedent()?$("ion-icon").name("arrow-forward-outline"):null,$("span").class("label").self(n=>n.dom.innerHTML=i.label.replaceAll(t,`<b>${t}</b>`))])]),i.isTag()?$("div").class("tag-detail").content([$("span").class("tag-post-count").content(ct(i.post_count)),$("span").class("tag-category").content(J[i.category])]):null,i.isUser()?$("span").class("user-level").content(i.level):null]).on("click",()=>{this.$tagInput.addTag(i.value).input()})))}search(){return $.replace(`/posts?tags=${this.$tagInput.query.replace(":","%3A")}`),this.$tagInput.clearAll(),this.inactivate(),this}checkURL(t,s){if((t==null?void 0:t.hash)==="#search"&&this.inactivate(),s.hash==="#search"&&this.activate(),`${t==null?void 0:t.pathname}${t==null?void 0:t.search}`==`${s.pathname}${s.search}`)return;const i=s.searchParams.get("tags");this.$tagInput.clearAll(),i==null||i.split(" ").forEach(n=>this.$tagInput.addTag(n))}};l(Tt,"$ele",new Tt().hide(!0));let nt=Tt;const Qe=$("route").path("/login").builder(({$page:r})=>{const e=$.state({apiKey:"",username:""}),t=$.css({display:"flex",flexDir:"column",gap:"0.5rem"}),s=$.css({display:"block"});return r.css({display:"flex",justify:"center",alignItems:"center",mT:"5rem",pos:"relative",pX:"1rem",pT:"var(--nav-height)"}).id("login").content([$("div").css({p:"2rem",b:"1px solid var(--secondary-color-9)",bRadius:"var(--border-radius-large)",display:"flex",flexDir:"column",justify:"center",gap:"1rem",maxW:"400px",w:"100%",sizing:"border-box"}).content([$("h1").css({m:0}).content("Login"),$("div").class("username").css(t).content([$("label").for("username").content("Username"),$("input").css(s).type("text").id("username").value(e.username$)]),$("div").class("api-key").css(t).content([$("label").for("api-key").content("API Key"),$("input").css(s).type("password").id("api-key").value(e.apiKey$)]),$("icon-button").content("Login").on("click",async()=>{await y.used.login(e.username$.value,e.apiKey$.value),y.used.user&&(z.storageUserData={apiKey:e.apiKey$.value,username:e.username$.value},e.username$.set(""),e.apiKey$.set(""),$.replace("/"))}),$("icon-button").content("Create Account").icon("open-outline").on("click",()=>$.open("https://danbooru.donmai.us/users/new","_blank"))])])}),Et=class Et extends p{constructor(){super("drawer");l(this,"$filter",$("div").class("filter"));l(this,"$container",$("div").class("drawer-container"));l(this,"pointers",$.pointers($(document.body)));l(this,"opened",!1);this.hide(!0),this.build()}build(){this.content([this.$container.content([$("div").class("user-info").hide(!0).self(t=>[y.events.on("login",s=>{t.content([$("div").content([$("h3").class("username").content(s.name$),$("div").class("user-detail").content([$("span").class("userid").content(`ID: ${s.id}`),$("span").class("level").content(["Level: ",s.level_string$])])]),$("div").class("user-nav").content([$("icon-button").title("Uploaded Posts").icon("image").content(s.post_upload_count$.convert(ct)).link(`/posts?tags=user:${s.name}`,!0),$("icon-button").title("Favorites").icon("heart").content(s.favorite_count$.convert(ct)).link(`/posts?tags=ordfav:${s.name}`,!0),$("icon-button").title("Forum Posts").icon("document-text").content(s.forum_post_count$.convert(ct)).hide(!0)])]).hide(!1)}).on("logout",()=>{t.clear().hide(!0)})]),$("div").class("nav").content([$("icon-button").icon("log-in-outline").content("Login").link("/login",!0).self(t=>y.events.on("login",()=>t.hide(!0)).on("logout",()=>t.hide(!1))),$("icon-button").icon("log-in-outline").content("Logout").on("dblclick",()=>y.used.logout()).hide(!0).self(t=>y.events.on("login",()=>t.hide(!1)).on("logout",()=>t.hide(!0))),$("icon-button").icon("swap-horizontal").class("switch").content("Switch Booru").on("click",()=>{y.used===Lt?y.set(Ne):y.set(Lt),this.close()})])]),this.$filter.on("click",()=>$.back())]),this.pointers.on("move",t=>{var s;(s=$(":slide-viewer"))!=null&&s.contains(t.$target)||(t.$target.parent,!(t.type!=="pen"&&t.type!=="touch")&&(t.move_y>4||t.move_y<-4||(t.move_x<=-7&&(t.delete(),this.open()),t.move_x>=7&&(t.delete(),this.close()))))})}open(){return location.hash!=="#drawer"&&$.open(location.href+"#drawer"),this}close(){return location.hash==="#drawer"&&$.back(),this}activate(){this.opened=!0,this.hide(!1),this.$container.animate({transform:["translateX(100%)","translateX(0%)"]},{fill:"both",duration:300,easing:"ease"}),this.$filter.animate({opacity:[0,1]},{fill:"both",duration:300,easing:"ease"})}inactivate(){this.opened=!1,this.$container.animate({transform:["translateX(0%)","translateX(100%)"]},{fill:"both",duration:300,easing:"ease"},()=>this.hide(!this.opened)),this.$filter.animate({opacity:[1,0]},{fill:"both",duration:300,easing:"ease"})}checkURL(t,s){(t==null?void 0:t.hash)==="#drawer"&&this.inactivate(),s.hash==="#drawer"&&this.activate()}};l(Et,"$ele",new Et);let ft=Et;const Ot=class Ot extends p{constructor(){super("nav"),this.build()}build(){this.content([$("a").class("title").href("/").content([$("h1").class("booru-name").content(y.name$),$("h2").class("app").content([$("span").class("app-name").content("Viewer"),$("span").class("version").content("v0.14.9")])]),$("div").class("searchbar").content(["Search in ",y.name$]).self(e=>O.events.on("stateChange",({beforeURL:t,afterURL:s})=>{t.hash==="#search"&&e.hide(!1),s.hash==="#search"&&e.hide(!0)})).on("click",()=>nt.$ele.open()),$("div").class("buttons").content([$("ion-icon").class("search").name("search-outline").title("Search").self(e=>O.events.on("stateChange",({beforeURL:t,afterURL:s})=>{t.hash==="#search"&&e.hide(!1),s.hash==="#search"&&e.hide(!0)})).on("click",()=>nt.$ele.open()),$("ion-icon").class("detail-panel").name("reader-outline").title("Toggle Detail Panel").on("click",()=>{$(":page#posts")?T.previewPanelEnable$.set(!T.previewPanelEnable$.value):$(":page#post")&&T.detailPanelEnable$.set(!T.detailPanelEnable$.value)}),$("a").content($("ion-icon").class("open").name("open-outline").title("Open in Original Site")).href(location.href.replace(location.origin,y.used.origin)).target("_blank"),$("ion-icon").class("copy").name("link-outline").title("Copy Page Link").hide(!1).on("click",(e,t)=>{navigator.clipboard.writeText(`${location.origin}${location.pathname}${location.search}`),t.name("checkmark-outline"),setTimeout(()=>{t.name("link-outline")},2e3)}),$("ion-icon").class("menu").name("menu-outline").title("Menu").hide(!1).self(e=>{y.events.on("login",()=>e.hide(!0)).on("logout",()=>e.hide(!1))}).on("click",()=>$.open(location.href+"#drawer")),$("div").class("account").hide(!0).title("Menu").self(e=>{y.events.on("login",t=>{e.content(t.name$.convert(s=>{var i;return((i=s.at(0))==null?void 0:i.toUpperCase())??""})).hide(!1)}).on("logout",()=>e.hide(!0))}).on("click",()=>ft.$ele.open())])])}};l(Ot,"$ele",new Ot);let Rt=Ot;class Ct extends p{constructor(t,s){super("post-tile");l(this,"post");l(this,"$video");l(this,"$img");l(this,"duration$",$.state(""));l(this,"$grid");this.$grid=t,this.post=s,this.$video=this.post.isVideo?$("video").width(this.post.image_width).height(this.post.image_height).disablePictureInPicture(!0).loop(!0).muted(!0).hide(!0).on("mousedown",i=>i.preventDefault()):null,this.$img=$("img").draggable(!1).style({opacity:"0"}).width(this.post.image_width).height(this.post.image_height).src(this.post.previewURL).loading("lazy"),this.attribute("filetype",this.post.file_ext),this.durationUpdate(),this.build()}build(){var t;(t=this.$video)==null||t.on("timeupdate",(s,i)=>{this.durationUpdate()}),this.class("loading").content([this.post.isVideo?$("div").class("video-detail").content([this.post.hasSound?$("ion-icon").name("volume-medium-outline"):null,this.post.isUgoria?$("ion-icon").name("images-outline"):null,$("span").class("duration").content(this.duration$)]):null,this.post.isGif?$("div").class("gif-detail").content([$("span").content("GIF")]):null,$("a").href(this.url).preventDefault(T.previewPanelEnable$).content(()=>[this.$video,this.$img.on("mousedown",s=>s.preventDefault()).once("load",(s,i)=>{i.animate({opacity:[0,1]},{duration:300},()=>i.style({opacity:""})),this.removeClass("loading")})])]),this.on(["focus","mouseenter","touchstart"],()=>{var s,i;(s=this.$video)!=null&&s.isPlaying||(i=this.$video)==null||i.src(this.post.large_file_url).hide(!1).play().catch(n=>{}),this.post.isGif&&this.$img.src(this.post.large_file_url)},{passive:!0}).on(["blur","mouseleave","touchend","touchcancel"],()=>{var s;(s=this.$video)==null||s.pause().currentTime(0).hide(!0),this.post.isGif&&this.$img.src(this.post.previewURL)},{passive:!0}).on("click",()=>{if(T.previewPanelEnable$.value){if(innerWidth<=800)return $.open(this.url);this.attribute("focus")===""?$.open(this.url):this.trigger("$focus")}})}durationUpdate(){if(!this.$video)return;const t=At(this.post.media_asset.duration*1e3-this.$video.currentTime()*1e3);this.duration$.set(Number(t.hh)>0?`${t.hh}:${t.mm}:${t.ss}`:`${t.mm}:${t.ss}`)}get url(){return`${this.post.pathname}${this.$grid.tags?`?q=${this.$grid.tags}`:""}`}}class Ze extends ie{constructor(t){super();l(this,"$postMap",new Map);l(this,"tags");l(this,"$focus",$.focus());l(this,"posts");this.tags=t==null?void 0:t.tags,this.posts=xt.get(this.tags),this.addStaticClass("post-grid"),this.type("waterfall").gap(10),this.init()}async init(){this.posts.events.on("post_fetch",s=>{this.renderPosts()});const t=setInterval(async()=>{if(this.posts.tag_list.includes("order:random"))return clearInterval(t);this.inDOM()&&document.documentElement.scrollTop===0&&await this.posts.fetchPosts("newer")},1e4);y.events.on("set",()=>{this.removeAll(),this.loader()}),this.on("resize",()=>this.resize()),this.loader(),this.$focus.layer(100).loop(!1).scrollThreshold($.rem(2)+60),$.keys($(window)).if(s=>{if(this.inDOM()&&!($(s.target)instanceof M))return!0}).keydown(["w","W"],s=>{s.preventDefault(),this.$focus.up()}).keydown(["s","S"],s=>{s.preventDefault(),this.$focus.down()}).keydown(["d","D"],s=>{s.preventDefault(),this.$focus.right()}).keydown(["a","A"],s=>{s.preventDefault(),this.$focus.left()}).keydown([" ","Enter"],s=>{var n;s.preventDefault();const i=(n=this.$focus.currentLayer)==null?void 0:n.currentFocus;i instanceof Ct&&$.open(i.url)}).keydown(["Escape"],s=>{s.preventDefault(),this.$focus.blur()})}async loader(){if(!this.inDOM())return setTimeout(()=>this.loader(),100);for(;this.inDOM()&&document.documentElement.scrollHeight<=innerHeight*2;)if(!(await this.posts.fetchPosts("older")).length)return;document.documentElement.scrollTop+innerHeight>document.documentElement.scrollHeight-innerHeight*2&&!(await this.posts.fetchPosts("older")).length||setTimeout(()=>this.loader(),100)}resize(){const t=Math.round(this.dom.clientWidth/300);this.column(t>=2?t:2)}renderPosts(){this.$focus.layer(100).elementSet.clear();const t=[...this.posts.orderMap.values()].map(s=>{const i=this.$postMap.get(s)??new Ct(this,s).on("$focus",(n,o)=>this.$focus.layer(100).focus(o));return this.$postMap.set(s,i),i.self(this.$focus.layer(100).add)});return this.content(t).render(),this}removeAll(){return this.$postMap.clear(),this.$focus.layer(100).removeAll(),this.animate({opacity:[1,0]},{duration:300,easing:"ease"},()=>this.clear().render()),this}}const ts=$("route").path(["/","/posts"]).builder(({$page:r,query:e})=>{const{$postGrid:t,$detail:s}=ce(r,e);return r.id("posts").content([t,s])}),es=$("route").path("/posts?tags").builder(({$page:r,query:e})=>{const{$postGrid:t,$detail:s}=ce(r,e);return r.id("posts").content([$("header").content([$("h2").content("Posts"),$("div").class("tags").self(i=>{e.tags.split("+").forEach(n=>{i.insert($("a").class("tag").content(decodeURIComponent(n)).href(`posts?tags=${n}`))})})]),$("div").class("no-post").hide(!0).self(i=>{i.on("startLoad",()=>i.hide(!0)),t.self(()=>{t.posts.events.on("noPost",()=>i.hide(!1).content("No Posts")).on("post_error",n=>i.hide(!1).content(n))})}),t,s])});function ce(r,e){const t=new Ze(e),s=new ae({preview:!0,tagsType:"name_only"}).hide(T.previewPanelEnable$.convert(n=>!n)).position(r);i(),T.previewPanelEnable$.on("update",i),y.events.on("set",()=>s.update(null));function i(){T.previewPanelEnable$.value?t.addClass("detail-panel-enabled"):t.removeClass("detail-panel-enabled")}return t.$focus.on("focus",({$focused:n})=>{n.inDOM()&&n instanceof Ct&&s.update(n.post)}).on("blur",()=>s.update(null)),{$postGrid:t,$detail:s}}$(document.body).content([Rt.$ele,nt.$ele,ft.$ele,$("router").base("/").on("beforeSwitch",ss).map([ts,es,Ge,Qe])]);function ss(r){r.preventDefault();function s(){var o;$(document.documentElement).style({scrollBehavior:"auto"});const n=$.call(()=>{switch(O.navigationDirection){case q.Forward:return["translateX(2%)","translateX(0%)"];case q.Back:return["translateX(-2%)","translateX(0%)"];case q.Replace:return""}});r.$view.content(r.nextContent),r.rendered(),(o=r.nextContent.element)==null||o.class("animated").animate({opacity:[0,1],transform:n},{duration:300,easing:"ease"},()=>{var a;r.switched(),$(document.documentElement).style({scrollBehavior:""}),(a=r.nextContent.element)==null||a.removeClass("animated")})}function i(){var o,a;$(document.documentElement).style({scrollBehavior:"auto"});const n=$.call(()=>{switch(O.navigationDirection){case q.Forward:return["translateX(0%)","translateX(-2%)"];case q.Back:return["translateX(0%)","translateX(2%)"];case q.Replace:return""}});(a=(o=r.previousContent)==null?void 0:o.element)==null||a.class("animated").animate({opacity:[1,0],transform:n},{duration:300,easing:"ease"},()=>{var c,h;(h=(c=r.previousContent)==null?void 0:c.element)==null||h.removeClass("animated"),s()})}r.previousContent?i():s()}O.events.on("stateChange",({beforeURL:r,afterURL:e})=>he(r,e));he(void 0,new URL(location.href));function he(r,e){nt.$ele.checkURL(r,e),ft.$ele.checkURL(r,e)}$.keys($(window)).if(r=>{if(!($(r.target)instanceof M))return!0}).keydown(["q","Q"],r=>{r.preventDefault(),O.index!==0&&$.back()}).keydown(["e","E"],r=>{r.preventDefault(),O.forwardIndex!==0&&$.forward()}).keydown("Tab",r=>{r.preventDefault(),$(":page#posts")?T.previewPanelEnable$.set(!T.previewPanelEnable$.value):$(":page#post")&&T.detailPanelEnable$.set(!T.detailPanelEnable$.value)});
